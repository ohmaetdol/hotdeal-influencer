<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•«ë”œê³µêµ¬ì¸í”Œë£¨ì–¸ì„œ - ê´€ë¦¬ì</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root{--primary:#1a73e8;--primary-light:#e8f0fe;--secondary:#202124;--text:#3c4043;--text-light:#5f6368;--bg:#fff;--bg-secondary:#f8f9fa;--border:#dadce0;--success:#1e8e3e;--error:#d93025;--warning:#f9ab00}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Noto Sans KR',sans-serif;background:var(--bg-secondary);color:var(--text)}
        .hidden{display:none!important}
        .btn{padding:10px 20px;border-radius:4px;font-weight:500;font-size:14px;cursor:pointer;border:none;font-family:inherit;transition:all .2s}
        .btn-primary{background:var(--primary);color:#fff}.btn-primary:hover{background:#1557b0}
        .btn-success{background:var(--success);color:#fff}
        .btn-danger{background:var(--error);color:#fff}
        .btn-small{padding:6px 12px;font-size:13px}
        .input-group{margin-bottom:16px}
        .input-group label{display:block;font-size:14px;margin-bottom:6px;font-weight:500}
        .input-group input,.input-group select{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:4px;font-size:14px;font-family:inherit}
        .input-group input:focus,.input-group select:focus{outline:none;border-color:var(--primary)}

        .login-page{min-height:100vh;display:flex;align-items:center;justify-content:center;background:var(--secondary)}
        .login-box{background:var(--bg);border-radius:8px;padding:40px;width:100%;max-width:400px}
        .login-box h1{font-size:20px;text-align:center;margin-bottom:24px}

        .layout{display:flex;min-height:100vh}
        .sidebar{width:220px;background:var(--secondary);color:#fff;padding:20px 0;position:fixed;height:100vh}
        .sidebar-logo{padding:0 20px 20px;font-size:14px;font-weight:600;border-bottom:1px solid rgba(255,255,255,0.1)}
        .sidebar-logo span{color:var(--primary)}
        .sidebar-menu{padding:20px 0}
        .sidebar-menu a{display:block;padding:12px 20px;color:rgba(255,255,255,0.7);text-decoration:none;font-size:14px;cursor:pointer}
        .sidebar-menu a:hover{background:rgba(255,255,255,0.05);color:#fff}
        .sidebar-menu a.active{background:var(--primary);color:#fff}
        
        .main{flex:1;margin-left:220px;padding:24px}
        .page-title{font-size:22px;font-weight:500;margin-bottom:24px}

        .stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px}
        .stat-card{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:20px}
        .stat-card.highlight{border-left:4px solid var(--warning)}
        .stat-label{font-size:12px;color:var(--text-light);margin-bottom:4px}
        .stat-value{font-size:24px;font-weight:500}
        .stat-value.primary{color:var(--primary)}
        .stat-value.success{color:var(--success)}
        .stat-value.warning{color:var(--warning)}

        .dashboard-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-bottom:24px}

        .todo-card{margin-bottom:24px}
        .todo-list{display:flex;flex-direction:column;gap:12px}
        .todo-item{display:flex;align-items:center;gap:12px;padding:14px 16px;background:var(--bg-secondary);border-radius:8px;border-left:4px solid var(--primary)}
        .todo-item.urgent{border-left-color:var(--error)}
        .todo-item.success{border-left-color:var(--success);opacity:0.7}
        .todo-icon{font-size:20px}
        .todo-content{flex:1}
        .todo-title{font-size:14px;font-weight:500;margin-bottom:2px}
        .todo-desc{font-size:12px;color:var(--text-light)}
        .todo-action{padding:6px 12px;background:var(--primary);color:#fff;border:none;border-radius:4px;font-size:12px;cursor:pointer;font-family:inherit}
        .todo-action:hover{background:#1557b0}

        .match-list{display:flex;flex-direction:column;gap:12px}
        .match-item{display:flex;align-items:center;gap:12px;padding:12px;background:var(--bg-secondary);border-radius:8px}
        .match-avatar{width:40px;height:40px;border-radius:50%;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:600}
        .match-info{flex:1}
        .match-name{font-size:13px;font-weight:500}
        .match-reason{font-size:11px;color:var(--text-light)}
        .match-product{font-size:12px;color:var(--primary);background:var(--primary-light);padding:4px 10px;border-radius:12px}

        .top-list{display:flex;flex-direction:column;gap:8px}
        .top-item{display:flex;align-items:center;gap:12px;padding:12px;background:var(--bg-secondary);border-radius:8px}
        .top-rank{font-size:18px;width:30px;text-align:center}
        .top-avatar{width:36px;height:36px;border-radius:50%;background:var(--primary-light);color:var(--primary);display:flex;align-items:center;justify-content:center;font-weight:600;font-size:14px}
        .top-info{flex:1}
        .top-name{font-size:13px;font-weight:500}
        .top-stats{font-size:11px;color:var(--text-light)}
        .top-amount{font-size:14px;font-weight:600;color:var(--success)}

        .header-badge{background:var(--error);color:#fff;padding:2px 8px;border-radius:10px;font-size:12px;margin-left:8px}

        .card{background:var(--bg);border:1px solid var(--border);border-radius:8px;margin-bottom:24px;overflow:hidden}
        .card-header{padding:16px 20px;border-bottom:1px solid var(--border);font-weight:500}
        .card-body{padding:20px}

        table{width:100%;border-collapse:collapse}
        th,td{padding:12px 16px;text-align:left;font-size:13px}
        th{background:var(--bg-secondary);font-weight:500;color:var(--text-light)}
        td{border-bottom:1px solid var(--border)}
        tr:last-child td{border-bottom:none}

        .badge{display:inline-block;padding:4px 8px;border-radius:4px;font-size:11px;font-weight:500}
        .badge-pending{background:#fef7e0;color:#b45309}
        .badge-success{background:#e6f4ea;color:var(--success)}
        .badge-primary{background:var(--primary-light);color:var(--primary)}

        .form-row{display:flex;gap:12px;align-items:end}
        .form-row .input-group{flex:1;margin-bottom:0}

        .empty{text-align:center;padding:40px;color:var(--text-light)}

        .toast{position:fixed;bottom:24px;right:24px;background:var(--success);color:#fff;padding:12px 20px;border-radius:4px;opacity:0;transition:all .3s}
        .toast.show{opacity:1}
        .toast.error{background:var(--error)}
        
        .loading{text-align:center;padding:40px;color:var(--text-light)}
        .loading::after{content:'';display:inline-block;width:20px;height:20px;border:2px solid var(--border);border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite;margin-left:10px;vertical-align:middle}
        @keyframes spin{to{transform:rotate(360deg)}}

        /* ì¸í”Œë£¨ì–¸ì„œ DB ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ */
        .influencer-card-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:16px}
        .influencer-card{background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:20px;cursor:pointer;transition:all .2s}
        .influencer-card:hover{box-shadow:0 4px 12px rgba(0,0,0,0.1);border-color:var(--primary)}
        .influencer-card-header{display:flex;align-items:center;gap:12px;margin-bottom:16px}
        .influencer-card-avatar{width:48px;height:48px;border-radius:50%;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:600}
        .influencer-card-avatar.silver{background:linear-gradient(135deg,#c0c0c0,#e8e8e8)}
        .influencer-card-avatar.gold{background:linear-gradient(135deg,#ffd700,#ffec8b)}
        .influencer-card-avatar.vip{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}
        .influencer-card-info h4{font-size:15px;margin-bottom:4px}
        .influencer-card-info p{font-size:12px;color:var(--text-light)}
        .influencer-card-grade{font-size:11px;padding:2px 8px;border-radius:10px;background:var(--bg-secondary)}
        .influencer-card-grade.silver{background:#e8e8e8;color:#666}
        .influencer-card-grade.gold{background:#fff3cd;color:#856404}
        .influencer-card-grade.vip{background:#e8f0fe;color:var(--primary)}
        .influencer-card-channels{display:flex;gap:6px;margin-bottom:12px;flex-wrap:wrap}
        .influencer-card-channel{font-size:11px;padding:4px 8px;border-radius:4px;background:var(--bg-secondary)}
        .influencer-card-channel.youtube{background:#fee2e2;color:#dc2626}
        .influencer-card-channel.instagram{background:#fce7f3;color:#db2777}
        .influencer-card-channel.blog{background:#dcfce7;color:#16a34a}
        .influencer-card-channel.tiktok{background:#f3e8ff;color:#7c3aed}
        .influencer-card-categories{font-size:11px;color:var(--text-light);margin-bottom:12px;line-height:1.5}
        .influencer-card-stats{display:flex;gap:16px;padding-top:12px;border-top:1px solid var(--border)}
        .influencer-card-stat{text-align:center}
        .influencer-card-stat span{display:block}
        .influencer-card-stat .num{font-size:16px;font-weight:600;color:var(--primary)}
        .influencer-card-stat .label{font-size:10px;color:var(--text-light)}
        .influencer-card-memo{font-size:11px;color:var(--text-light);margin-top:10px;padding:8px;background:var(--bg-secondary);border-radius:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .influencer-card-matched{margin-top:10px;padding:8px;background:#e8f0fe;border-radius:4px}
        .influencer-card-matched-title{font-size:10px;color:var(--primary);font-weight:500;margin-bottom:4px}
        .influencer-card-matched-products{font-size:11px;color:var(--text)}
        
        /* ë“±ê¸‰ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .influencer-card-grade-info{display:flex;gap:12px;margin-bottom:10px;align-items:center}
        .grade-commission{font-size:12px;font-weight:600;color:var(--primary)}
        .grade-benefit{font-size:11px;color:var(--success)}
        .influencer-card-progress{margin-bottom:12px}
        .influencer-card-progress .progress-bar{height:6px;background:var(--bg-secondary);border-radius:3px;overflow:hidden;margin-bottom:4px}
        .influencer-card-progress .progress-fill{height:100%;background:linear-gradient(90deg,var(--primary),#4f46e5);border-radius:3px}
        .influencer-card-progress .progress-text{font-size:10px;color:var(--text-light)}

        /* ì¸í”Œë£¨ì–¸ì„œ ìƒì„¸ ëª¨ë‹¬ */
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;visibility:hidden;transition:all .2s}
        .modal-overlay.show{opacity:1;visibility:visible}
        .influencer-detail-modal{background:var(--bg);border-radius:12px;width:90%;max-width:700px;max-height:90vh;overflow:hidden;display:flex;flex-direction:column}
        .modal-header{padding:20px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
        .modal-header h2{font-size:18px}
        .close-btn{background:none;border:none;font-size:24px;cursor:pointer;color:var(--text-light)}
        .modal-body{padding:20px;overflow-y:auto;flex:1}
        .modal-footer{padding:16px 20px;border-top:1px solid var(--border);display:flex;gap:8px;justify-content:flex-end}
        .detail-section{margin-bottom:24px}
        .detail-section h3{font-size:14px;font-weight:600;margin-bottom:12px;color:var(--text)}
        .detail-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
        .detail-item{background:var(--bg-secondary);padding:12px;border-radius:6px}
        .detail-item label{font-size:11px;color:var(--text-light);display:block;margin-bottom:4px}
        .detail-item span{font-size:14px;font-weight:500}
        .modal-channels{display:flex;flex-direction:column;gap:8px}
        .modal-channel-item{display:flex;align-items:center;gap:12px;padding:10px;background:var(--bg-secondary);border-radius:6px}
        .modal-channel-icon{width:32px;height:32px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600}
        .modal-channel-icon.youtube{background:#fee2e2;color:#dc2626}
        .modal-channel-icon.instagram{background:#fce7f3;color:#db2777}
        .modal-channel-icon.blog{background:#dcfce7;color:#16a34a}
        .modal-channel-icon.tiktok{background:#f3e8ff;color:#7c3aed}
        .modal-channel-url{font-size:12px;color:var(--primary);word-break:break-all}
        .modal-categories{display:flex;flex-wrap:wrap;gap:6px}
        .modal-category-tag{padding:6px 12px;background:var(--primary-light);color:var(--primary);border-radius:16px;font-size:12px}
        .detail-stats{display:flex;gap:16px}
        .detail-stat{flex:1;text-align:center;padding:16px;background:var(--bg-secondary);border-radius:8px}
        .detail-stat .stat-num{font-size:24px;font-weight:600;color:var(--primary);display:block}
        .detail-stat .stat-label{font-size:11px;color:var(--text-light)}
        .modal-sales-history{max-height:150px;overflow-y:auto}
        .modal-sales-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border);font-size:12px}
        .modal-sales-item:last-child{border-bottom:none}
        .modal-product-match{display:flex;flex-direction:column;gap:8px;max-height:200px;overflow-y:auto}
        .product-match-item{display:flex;align-items:center;gap:12px;padding:10px;background:var(--bg-secondary);border-radius:6px}
        .product-match-item input{width:18px;height:18px}
        .product-match-info{flex:1}
        .product-match-name{font-size:13px;font-weight:500}
        .product-match-category{font-size:11px;color:var(--text-light)}
        #modalMemo{width:100%;padding:12px;border:1px solid var(--border);border-radius:6px;font-size:13px;font-family:inherit;resize:vertical}
        .grade-selector{display:flex;gap:16px;flex-wrap:wrap}
        .grade-selector label{display:flex;align-items:center;gap:6px;font-size:13px;cursor:pointer}
        .grade-selector input{width:16px;height:16px}
        .btn-secondary{background:var(--bg-secondary);color:var(--text);border:1px solid var(--border)}
        
        /* ëª¨ë‹¬ ë“±ê¸‰ ì¹´ë“œ */
        .modal-grade-card{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:12px;padding:20px;color:#fff}
        .modal-grade-header{display:flex;align-items:center;gap:16px;margin-bottom:16px}
        .modal-grade-icon{font-size:40px}
        .modal-grade-info{flex:1}
        .modal-grade-name{font-size:24px;font-weight:700;display:block}
        .modal-grade-commission{font-size:14px;opacity:0.9}
        .modal-grade-benefit{font-size:13px;background:rgba(255,255,255,0.2);padding:8px 16px;border-radius:20px}
        .modal-grade-progress{margin-top:12px}
        .modal-grade-progress-bar{height:8px;background:rgba(255,255,255,0.3);border-radius:4px;overflow:hidden;margin-bottom:8px}
        .modal-grade-progress-fill{height:100%;background:#fff;border-radius:4px}
        .modal-grade-progress-text{font-size:12px;opacity:0.9}
        
        /* ë“±ê¸‰ ë¶„í¬ */
        .grade-distribution{display:flex;gap:12px;flex-wrap:wrap}
        .grade-dist-item{flex:1;min-width:100px;padding:16px;border-radius:12px;text-align:center;cursor:pointer;transition:all .2s}
        .grade-dist-item:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.1)}
        .grade-dist-icon{font-size:28px;margin-bottom:8px}
        .grade-dist-name{font-size:12px;font-weight:600;margin-bottom:4px}
        .grade-dist-count{font-size:20px;font-weight:700}
        .grade-dist-percent{font-size:10px;opacity:0.7}

        /* ì¸í”Œë£¨ì–¸ì„œ ë§¤ì¹­ ìŠ¤íƒ€ì¼ */
        .matching-product-select select{width:100%;padding:12px 16px;font-size:14px;border:1px solid var(--border);border-radius:8px;font-family:inherit;cursor:pointer}
        .matching-product-select select:focus{outline:none;border-color:var(--primary)}
        .selected-product-info{display:flex;gap:16px;margin-top:16px;padding:16px;background:var(--bg-secondary);border-radius:12px}
        .selected-product-image{width:80px;height:80px;border-radius:8px;overflow:hidden;flex-shrink:0}
        .selected-product-image img{width:100%;height:100%;object-fit:cover}
        .selected-product-details h3{font-size:15px;font-weight:600;margin-bottom:6px}
        .selected-product-details p{font-size:13px;color:var(--text-light);margin-bottom:2px}
        
        .filter-row{display:flex;gap:16px;flex-wrap:wrap}
        .filter-group{flex:1;min-width:150px}
        .filter-group label{display:block;font-size:12px;color:var(--text-light);margin-bottom:6px;font-weight:500}
        .filter-group select{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:6px;font-size:13px;font-family:inherit}
        .filter-group select:focus{outline:none;border-color:var(--primary)}

        .matching-results{max-height:600px;overflow-y:auto}
        .empty-matching{padding:60px 20px;text-align:center;color:var(--text-light)}
        
        .matching-card{display:flex;align-items:center;gap:16px;padding:16px 20px;border-bottom:1px solid var(--border);transition:all .2s}
        .matching-card:last-child{border-bottom:none}
        .matching-card:hover{background:var(--bg-secondary)}
        .matching-avatar{width:48px;height:48px;border-radius:50%;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:600;flex-shrink:0}
        .matching-avatar.has-image{padding:0;overflow:hidden}
        .matching-avatar img{width:100%;height:100%;object-fit:cover}
        .matching-info{flex:1;min-width:0}
        .matching-name{font-size:14px;font-weight:600;margin-bottom:4px;display:flex;align-items:center;gap:8px}
        .matching-grade{font-size:11px;padding:2px 8px;border-radius:10px;background:var(--bg-secondary)}
        .matching-meta{font-size:12px;color:var(--text-light);margin-bottom:6px}
        .matching-channels{display:flex;gap:6px;flex-wrap:wrap}
        .matching-channel{font-size:11px;padding:3px 8px;border-radius:4px;font-weight:500}
        .matching-channel.instagram{background:#fce7f3;color:#db2777}
        .matching-channel.youtube{background:#fee2e2;color:#dc2626}
        .matching-channel.blog{background:#dcfce7;color:#16a34a}
        .matching-channel.tiktok{background:#f3e8ff;color:#7c3aed}
        .matching-score{text-align:right;flex-shrink:0}
        .matching-score-value{font-size:24px;font-weight:700;color:var(--primary)}
        .matching-score-label{font-size:11px;color:var(--text-light)}
        .matching-stats{display:flex;gap:16px;margin-top:8px}
        .matching-stat{font-size:11px;color:var(--text-light)}
        .matching-stat strong{color:var(--text);font-weight:600}
        
        .matching-contact-btns{display:flex;gap:8px;margin-top:10px}
        .contact-btn{display:inline-flex;align-items:center;gap:4px;padding:6px 12px;border-radius:6px;font-size:12px;font-weight:500;text-decoration:none;transition:all .2s}
        .contact-btn.call{background:#dcfce7;color:#16a34a}
        .contact-btn.call:hover{background:#bbf7d0}
        .contact-btn.sms{background:#e0f2fe;color:#0284c7}
        .contact-btn.sms:hover{background:#bae6fd}
        .no-contact{font-size:11px;color:var(--text-light);padding:6px 0}

        @media(max-width:768px){.sidebar{display:none}.main{margin-left:0}.stats-grid{grid-template-columns:1fr 1fr}.influencer-card-list{grid-template-columns:1fr}.detail-grid{grid-template-columns:1fr}.filter-row{flex-direction:column}.filter-group{min-width:100%}}

        /* ============================================
           ğŸ”¥ ê´€ë¦¬ì ëª¨ë°”ì¼ ìµœì í™” ìŠ¤íƒ€ì¼
           ============================================ */
        
        /* ëª¨ë°”ì¼ í—¤ë” */
        .mobile-header{
            display:none;
            position:fixed;
            top:0;
            left:0;
            right:0;
            height:56px;
            background:var(--secondary);
            color:#fff;
            padding:0 16px;
            z-index:200;
            align-items:center;
            justify-content:space-between;
        }
        .mobile-header-logo{
            font-size:14px;
            font-weight:600;
        }
        .mobile-header-logo span{color:var(--primary)}
        .mobile-menu-btn{
            background:none;
            border:none;
            color:#fff;
            font-size:24px;
            padding:8px;
            cursor:pointer;
        }

        /* ëª¨ë°”ì¼ ì‚¬ì´ë“œ ë©”ë‰´ (ìŠ¬ë¼ì´ë“œ) */
        .mobile-sidebar-overlay{
            position:fixed;
            inset:0;
            background:rgba(0,0,0,0.5);
            z-index:300;
            opacity:0;
            visibility:hidden;
            transition:all .3s;
        }
        .mobile-sidebar-overlay.show{
            opacity:1;
            visibility:visible;
        }
        .mobile-sidebar{
            position:fixed;
            top:0;
            left:-280px;
            width:280px;
            height:100vh;
            background:var(--secondary);
            z-index:301;
            transition:left .3s ease;
            overflow-y:auto;
        }
        .mobile-sidebar-overlay.show .mobile-sidebar{
            left:0;
        }
        .mobile-sidebar-header{
            padding:20px;
            border-bottom:1px solid rgba(255,255,255,0.1);
            display:flex;
            justify-content:space-between;
            align-items:center;
        }
        .mobile-sidebar-header h2{
            font-size:16px;
            color:#fff;
            margin:0;
        }
        .mobile-sidebar-header h2 span{color:var(--primary)}
        .mobile-sidebar-close{
            background:none;
            border:none;
            color:rgba(255,255,255,0.7);
            font-size:24px;
            cursor:pointer;
        }
        .mobile-sidebar-menu{
            padding:16px 0;
        }
        .mobile-sidebar-menu a{
            display:flex;
            align-items:center;
            gap:12px;
            padding:14px 20px;
            color:rgba(255,255,255,0.7);
            text-decoration:none;
            font-size:15px;
            transition:all .2s;
        }
        .mobile-sidebar-menu a:hover,
        .mobile-sidebar-menu a.active{
            background:var(--primary);
            color:#fff;
        }
        .mobile-sidebar-menu a .menu-icon{
            font-size:18px;
            width:24px;
            text-align:center;
        }

        @media(max-width:768px){
            .mobile-header{display:flex}
            .main{margin-left:0;padding-top:72px;padding:72px 12px 24px}
            .page-title{font-size:18px;margin-bottom:16px}
            
            /* ì¹´ë“œ ê·¸ë¦¬ë“œ */
            .stats-grid{grid-template-columns:repeat(2,1fr);gap:10px}
            .stat-card{padding:14px 12px}
            .stat-label{font-size:10px}
            .stat-value{font-size:20px}
            
            .dashboard-grid{grid-template-columns:1fr;gap:12px}
            
            /* ì¹´ë“œ */
            .card{border-radius:12px;margin-bottom:16px}
            .card-header{padding:14px 16px;font-size:14px}
            .card-body{padding:14px 16px}
            
            /* í…Œì´ë¸” ëª¨ë°”ì¼ */
            table{font-size:12px}
            th,td{padding:10px 8px}
            
            /* íˆ¬ë‘ ë¦¬ìŠ¤íŠ¸ */
            .todo-item{flex-wrap:wrap;padding:12px}
            .todo-icon{font-size:18px}
            .todo-title{font-size:13px}
            .todo-desc{font-size:11px}
            .todo-action{margin-top:8px;width:100%}
            
            /* ë“±ê¸‰ ë¶„í¬ */
            .grade-distribution{gap:8px}
            .grade-dist-item{min-width:calc(50% - 4px);padding:12px}
            .grade-dist-icon{font-size:22px;margin-bottom:6px}
            .grade-dist-name{font-size:11px}
            .grade-dist-count{font-size:16px}
            
            /* ì¸í”Œë£¨ì–¸ì„œ ì¹´ë“œ */
            .influencer-card-list{grid-template-columns:1fr}
            .influencer-card{padding:16px}
            .influencer-card-header{margin-bottom:12px}
            .influencer-card-avatar{width:40px;height:40px;font-size:16px}
            .influencer-card-info h4{font-size:14px}
            
            /* ëª¨ë‹¬ */
            .modal-overlay{align-items:flex-end;padding:0}
            .influencer-detail-modal{
                width:100%;
                max-width:100%;
                max-height:90vh;
                border-radius:20px 20px 0 0;
            }
            .modal-header{padding:16px}
            .modal-header h2{font-size:16px}
            .modal-body{padding:16px}
            .modal-footer{padding:12px 16px}
            
            /* í¼ ìš”ì†Œ */
            .form-row{flex-direction:column;gap:12px}
            .input-group{margin-bottom:12px}
            .input-group label{font-size:13px}
            .input-group input,
            .input-group select{
                padding:12px;
                font-size:15px;
            }
            
            /* ë²„íŠ¼ */
            .btn{
                min-height:44px;
                padding:12px 16px;
            }
            .btn-small{
                min-height:36px;
                padding:8px 12px;
            }
        }

        /* ì•„ì£¼ ì‘ì€ í™”ë©´ */
        @media(max-width:380px){
            .main{padding:64px 8px 16px}
            .page-title{font-size:16px}
            .stats-grid{gap:8px}
            .stat-card{padding:12px 10px}
            .stat-value{font-size:18px}
            .card-header{font-size:13px}
            table{font-size:11px}
            th,td{padding:8px 6px}
        }

        /* Safe area ëŒ€ì‘ */
        @supports(padding: max(0px)){
            .mobile-header{
                padding-top:max(0px, env(safe-area-inset-top));
                height:calc(56px + env(safe-area-inset-top));
            }
            @media(max-width:768px){
                .main{
                    padding-top:calc(72px + env(safe-area-inset-top));
                }
            }
        }

        /* í„°ì¹˜ ìµœì í™” */
        @media(max-width:768px){
            *{-webkit-tap-highlight-color:transparent}
            .sidebar-menu a,
            .mobile-sidebar-menu a,
            .influencer-card,
            .todo-action,
            .btn{
                -webkit-tap-highlight-color:transparent;
            }
        }
    </style>
</head>
<body>
    <div id="loginPage" class="login-page">
        <div class="login-box">
            <h1>ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</h1>
            <div class="input-group">
                <label>ID</label>
                <input type="text" id="adminId" placeholder="admin">
            </div>
            <div class="input-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="adminPw" placeholder="ë¹„ë°€ë²ˆí˜¸" onkeypress="if(event.key==='Enter')login()">
            </div>
            <button class="btn btn-primary" style="width:100%" onclick="login()">ë¡œê·¸ì¸</button>
        </div>
    </div>

    <div id="dashboard" class="layout hidden">
        <!-- ëª¨ë°”ì¼ í—¤ë” -->
        <header class="mobile-header">
            <button class="mobile-menu-btn" onclick="openMobileSidebar()">â˜°</button>
            <div class="mobile-header-logo">í•«ë”œê³µêµ¬<span>ì¸í”Œë£¨ì–¸ì„œ</span> ê´€ë¦¬ì</div>
            <button class="mobile-menu-btn" onclick="logout()" title="ë¡œê·¸ì•„ì›ƒ">ğŸšª</button>
        </header>

        <!-- ëª¨ë°”ì¼ ì‚¬ì´ë“œ ë©”ë‰´ ì˜¤ë²„ë ˆì´ -->
        <div class="mobile-sidebar-overlay" id="mobileSidebarOverlay" onclick="closeMobileSidebar()">
            <nav class="mobile-sidebar" onclick="event.stopPropagation()">
                <div class="mobile-sidebar-header">
                    <h2>í•«ë”œê³µêµ¬<span>ì¸í”Œë£¨ì–¸ì„œ</span></h2>
                    <button class="mobile-sidebar-close" onclick="closeMobileSidebar()">âœ•</button>
                </div>
                <div class="mobile-sidebar-menu">
                    <a class="active" onclick="showSectionMobile('overview',this)">ëŒ€ì‹œë³´ë“œ</a>
                    <a onclick="showSectionMobile('applications',this)">ê°€ì… ì‹ ì²­</a>
                    <a onclick="showSectionMobile('influencers',this)">ì¸í”Œë£¨ì–¸ì„œ</a>
                    <a onclick="showSectionMobile('influencerDB',this)">ì¸í”Œë£¨ì–¸ì„œ DB</a>
                    <a onclick="showSectionMobile('matching',this)">ì¸í”Œë£¨ì–¸ì„œ ë§¤ì¹­</a>
                    <a onclick="showSectionMobile('analytics',this)">ì„±ê³¼ë¶„ì„</a>
                    <a onclick="showSectionMobile('products',this)">ìƒí’ˆ ê´€ë¦¬</a>
                    <a onclick="showSectionMobile('sales',this)">íŒë§¤ ì…ë ¥</a>
                    <a onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a>
                </div>
            </nav>
        </div>

        <aside class="sidebar">
            <div class="sidebar-logo">í•«ë”œê³µêµ¬<span>ì¸í”Œë£¨ì–¸ì„œ</span></div>
            <nav class="sidebar-menu">
                <a class="active" onclick="showSection('overview',this)">ëŒ€ì‹œë³´ë“œ</a>
                <a onclick="showSection('applications',this)">ê°€ì… ì‹ ì²­</a>
                <a onclick="showSection('influencers',this)">ì¸í”Œë£¨ì–¸ì„œ</a>
                <a onclick="showSection('influencerDB',this)">ì¸í”Œë£¨ì–¸ì„œ DB</a>
                <a onclick="showSection('matching',this)">ì¸í”Œë£¨ì–¸ì„œ ë§¤ì¹­</a>
                <a onclick="showSection('analytics',this)">ì„±ê³¼ë¶„ì„</a>
                <a onclick="showSection('products',this)">ìƒí’ˆ ê´€ë¦¬</a>
                <a onclick="showSection('sales',this)">íŒë§¤ ì…ë ¥</a>
                <a onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a>
            </nav>
        </aside>

        <main class="main">
            <div id="sectionOverview">
                <h1 class="page-title">ëŒ€ì‹œë³´ë“œ</h1>
                
                <!-- í•µì‹¬ ì§€í‘œ ì¹´ë“œ -->
                <div class="stats-grid">
                    <div class="stat-card highlight"><div class="stat-label">ìŠ¹ì¸ ëŒ€ê¸°</div><div class="stat-value warning" id="pendingCount">0</div></div>
                    <div class="stat-card"><div class="stat-label">í™œì„± ì¸í”Œë£¨ì–¸ì„œ</div><div class="stat-value" id="activeCount">0</div></div>
                    <div class="stat-card"><div class="stat-label">ì´ë²ˆ ë‹¬ ë§¤ì¶œ</div><div class="stat-value primary" id="monthSales">â‚©0</div></div>
                    <div class="stat-card"><div class="stat-label">ì´ë²ˆ ë‹¬ ìˆ˜ìµ ì§€ê¸‰</div><div class="stat-value success" id="monthCommission">â‚©0</div></div>
                </div>

                <!-- ì˜¤ëŠ˜ì˜ í•  ì¼ -->
                <div class="card todo-card">
                    <div class="card-header">ì˜¤ëŠ˜ì˜ í•  ì¼</div>
                    <div class="card-body">
                        <div id="todoList" class="todo-list">
                            <!-- ë™ì  ìƒì„± -->
                        </div>
                    </div>
                </div>
                
                <!-- ë“±ê¸‰ë³„ ì¸í”Œë£¨ì–¸ì„œ í˜„í™© -->
                <div class="card">
                    <div class="card-header">ë“±ê¸‰ë³„ ì¸í”Œë£¨ì–¸ì„œ í˜„í™©</div>
                    <div class="card-body">
                        <div id="gradeDistribution" class="grade-distribution">
                            <!-- ë™ì  ìƒì„± -->
                        </div>
                    </div>
                </div>

                <!-- 2ì—´ ë ˆì´ì•„ì›ƒ -->
                <div class="dashboard-grid">
                    <!-- ë§¤ì¹­ ì¶”ì²œ -->
                    <div class="card">
                        <div class="card-header">ì˜¤ëŠ˜ì˜ ë§¤ì¹­ ì¶”ì²œ</div>
                        <div class="card-body">
                            <div id="matchRecommendations" class="match-list">
                                <!-- ë™ì  ìƒì„± -->
                            </div>
                        </div>
                    </div>

                    <!-- TOP ì¸í”Œë£¨ì–¸ì„œ -->
                    <div class="card">
                        <div class="card-header">ì´ë²ˆ ì£¼ TOP ì¸í”Œë£¨ì–¸ì„œ</div>
                        <div class="card-body">
                            <div id="topInfluencers" class="top-list">
                                <!-- ë™ì  ìƒì„± -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ìµœê·¼ í™œë™ -->
                <div class="card">
                    <div class="card-header">ìµœê·¼ í™œë™</div>
                    <table><thead><tr><th>ì‹œê°„</th><th>í™œë™</th><th>ì¸í”Œë£¨ì–¸ì„œ</th><th>ìƒí’ˆ</th><th>ê¸ˆì•¡</th></tr></thead><tbody id="recentSalesTable"></tbody></table>
                </div>
            </div>

            <div id="sectionApplications" class="hidden">
                <h1 class="page-title">ê°€ì… ì‹ ì²­</h1>
                <div class="card">
                    <div class="card-header">ìŠ¹ì¸ ëŒ€ê¸° ëª©ë¡ <span class="header-badge" id="pendingBadge">0</span></div>
                    <table><thead><tr><th>ì‹ ì²­ì¼</th><th>ì´ë©”ì¼</th><th>ì´ë¦„</th><th>ì—°ë½ì²˜</th><th>ì±„ë„</th><th>ê´€ë¦¬</th></tr></thead><tbody id="applicationsTable"></tbody></table>
                </div>
            </div>

            <div id="sectionInfluencers" class="hidden">
                <h1 class="page-title">ì¸í”Œë£¨ì–¸ì„œ ê´€ë¦¬</h1>
                <div class="card">
                    <div class="card-header">ìŠ¹ì¸ëœ ì¸í”Œë£¨ì–¸ì„œ</div>
                    <table><thead><tr><th>ì´ë¦„</th><th>ì¶”ì²œì½”ë“œ</th><th>ì±„ë„</th><th>íŒë§¤</th><th>ë§¤ì¶œ</th><th>ìˆ˜ìµ</th></tr></thead><tbody id="influencersTable"></tbody></table>
                </div>
            </div>

            <div id="sectionInfluencerDB" class="hidden">
                <h1 class="page-title">ì¸í”Œë£¨ì–¸ì„œ DB</h1>
                
                <!-- ê²€ìƒ‰/í•„í„° -->
                <div class="card" style="margin-bottom:20px">
                    <div class="card-body">
                        <div class="form-row" style="align-items:flex-end">
                            <div class="input-group" style="flex:2">
                                <label>ê²€ìƒ‰</label>
                                <input type="text" id="dbSearch" placeholder="ì´ë¦„, ì—°ë½ì²˜, ì±„ë„ URL ê²€ìƒ‰..." onkeyup="filterInfluencerDB()">
                            </div>
                            <div class="input-group">
                                <label>ì±„ë„</label>
                                <select id="dbChannelFilter" onchange="filterInfluencerDB()">
                                    <option value="all">ì „ì²´</option>
                                    <option value="youtube">YouTube</option>
                                    <option value="instagram">Instagram</option>
                                    <option value="blog">ë¸”ë¡œê·¸</option>
                                    <option value="tiktok">TikTok</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>ì¹´í…Œê³ ë¦¬</label>
                                <select id="dbCategoryFilter" onchange="filterInfluencerDB()">
                                    <option value="all">ì „ì²´</option>
                                    <option value="dessert">ë””ì €íŠ¸/ìŒì‹</option>
                                    <option value="beauty">ë·°í‹°</option>
                                    <option value="fashion">íŒ¨ì…˜</option>
                                    <option value="living">ìƒí™œìš©í’ˆ</option>
                                    <option value="electronics">ì „ìê¸°ê¸°</option>
                                    <option value="kids">ìœ¡ì•„/í‚¤ì¦ˆ</option>
                                    <option value="health">ê±´ê°•/í—¬ìŠ¤</option>
                                    <option value="pet">ë°˜ë ¤ë™ë¬¼</option>
                                    <option value="travel">ì—¬í–‰</option>
                                    <option value="interior">ì¸í…Œë¦¬ì–´</option>
                                    <option value="book">ë„ì„œ/êµìœ¡</option>
                                    <option value="hobby">ì·¨ë¯¸/ê²Œì„</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>ìƒíƒœ</label>
                                <select id="dbStatusFilter" onchange="filterInfluencerDB()">
                                    <option value="all">ì „ì²´</option>
                                    <option value="active">í™œë™ì¤‘ (íŒë§¤ìˆìŒ)</option>
                                    <option value="inactive">ë¯¸í™œë™</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>ë“±ê¸‰</label>
                                <select id="dbGradeFilter" onchange="filterInfluencerDB()">
                                    <option value="all">ì „ì²´ ë“±ê¸‰</option>
                                    <option value="seed">ì”¨ì•—</option>
                                    <option value="sprout">ìƒˆì‹¹</option>
                                    <option value="bronze">ë¸Œë¡ ì¦ˆ</option>
                                    <option value="silver">ì‹¤ë²„</option>
                                    <option value="gold">ê³¨ë“œ</option>
                                    <option value="diamond">ë‹¤ì´ì•„</option>
                                    <option value="master">ë§ˆìŠ¤í„°</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì¸í”Œë£¨ì–¸ì„œ ì¹´ë“œ ëª©ë¡ -->
                <div id="influencerCardList" class="influencer-card-list">
                    <!-- ì¹´ë“œë“¤ì´ ì—¬ê¸° ë Œë”ë§ë¨ -->
                </div>
            </div>

            <!-- ì¸í”Œë£¨ì–¸ì„œ ìƒì„¸ ëª¨ë‹¬ -->
            <div class="modal-overlay" id="influencerModal">
                <div class="modal influencer-detail-modal">
                    <div class="modal-header">
                        <h2 id="modalInfluencerName">ì¸í”Œë£¨ì–¸ì„œ ìƒì„¸</h2>
                        <button class="close-btn" onclick="closeInfluencerModal()">âœ•</button>
                    </div>
                    <div class="modal-body">
                        <!-- ë“±ê¸‰ ì •ë³´ -->
                        <div class="detail-section">
                            <h3>ë“±ê¸‰ ì •ë³´</h3>
                            <div class="modal-grade-card" id="modalGradeCard">
                                <div class="modal-grade-header">
                                    <span class="modal-grade-icon" id="modalGradeIcon">ğŸŒ±</span>
                                    <div class="modal-grade-info">
                                        <span class="modal-grade-name" id="modalGradeName">ì”¨ì•—</span>
                                        <span class="modal-grade-commission" id="modalGradeCommission">ìˆ˜ìˆ˜ë£Œ 8%</span>
                                    </div>
                                    <div class="modal-grade-benefit" id="modalGradeBenefit">ì¼ë°˜ ìƒí’ˆ</div>
                                </div>
                                <div class="modal-grade-progress">
                                    <div class="modal-grade-progress-bar"><div class="modal-grade-progress-fill" id="modalGradeProgressFill"></div></div>
                                    <span class="modal-grade-progress-text" id="modalGradeProgressText">ë‹¤ìŒ ë“±ê¸‰ê¹Œì§€ 5ê±´ ë‚¨ìŒ</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h3>ê¸°ë³¸ ì •ë³´</h3>
                            <div class="detail-grid">
                                <div class="detail-item"><label>ì´ë¦„</label><span id="modalName">-</span></div>
                                <div class="detail-item"><label>ì¶”ì²œì½”ë“œ</label><span id="modalCode">-</span></div>
                                <div class="detail-item"><label>ì—°ë½ì²˜</label><span id="modalContact">-</span></div>
                                <div class="detail-item"><label>ì´ë©”ì¼</label><span id="modalEmail">-</span></div>
                                <div class="detail-item"><label>ê°€ì…ì¼</label><span id="modalJoinDate">-</span></div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h3>ì±„ë„ ì •ë³´</h3>
                            <div id="modalChannels" class="modal-channels"></div>
                        </div>
                        
                        <div class="detail-section">
                            <h3>ê´€ì‹¬ ì¹´í…Œê³ ë¦¬</h3>
                            <div id="modalCategories" class="modal-categories"></div>
                        </div>
                        
                        <div class="detail-section">
                            <h3>íŒë§¤ ì‹¤ì </h3>
                            <div class="detail-stats">
                                <div class="detail-stat"><span class="stat-num" id="modalTotalSales">0</span><span class="stat-label">ì´ íŒë§¤</span></div>
                                <div class="detail-stat"><span class="stat-num" id="modalTotalAmount">â‚©0</span><span class="stat-label">ì´ ë§¤ì¶œ</span></div>
                                <div class="detail-stat"><span class="stat-num" id="modalTotalCommission">â‚©0</span><span class="stat-label">ì´ ìˆ˜ìµ</span></div>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h3>íŒë§¤ ì´ë ¥ (ìµœê·¼ 10ê±´)</h3>
                            <div id="modalSalesHistory" class="modal-sales-history"></div>
                        </div>
                        
                        <div class="detail-section">
                            <h3>ì¶”ì²œ ìƒí’ˆ ë§¤ì¹­</h3>
                            <p style="font-size:12px;color:var(--text-muted);margin-bottom:12px">ì´ ì¸í”Œë£¨ì–¸ì„œì—ê²Œ ì¶”ì²œí•  ìƒí’ˆì„ ì„ íƒí•˜ì„¸ìš”</p>
                            <div id="modalProductMatch" class="modal-product-match"></div>
                        </div>
                        
                        <div class="detail-section">
                            <h3>ê´€ë¦¬ì ë©”ëª¨</h3>
                            <textarea id="modalMemo" placeholder="ì´ ì¸í”Œë£¨ì–¸ì„œì— ëŒ€í•œ ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš” (íŠ¹ì§•, í˜‘ì—… ì´ë ¥, ì£¼ì˜ì‚¬í•­ ë“±)" rows="3"></textarea>
                        </div>
                        
                        <div class="detail-section">
                            <h3>ë“±ê¸‰ ì„¤ì •</h3>
                            <div class="grade-selector">
                                <label><input type="radio" name="influencerGrade" value="normal"> ì¼ë°˜</label>
                                <label><input type="radio" name="influencerGrade" value="silver"> ì‹¤ë²„</label>
                                <label><input type="radio" name="influencerGrade" value="gold"> ê³¨ë“œ</label>
                                <label><input type="radio" name="influencerGrade" value="vip"> VIP</label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" onclick="saveInfluencerDetail()">ì €ì¥</button>
                        <button class="btn btn-secondary" onclick="closeInfluencerModal()">ë‹«ê¸°</button>
                    </div>
                    <input type="hidden" id="modalInfluencerId" value="">
                </div>
            </div>

            <!-- ì¸í”Œë£¨ì–¸ì„œ ë§¤ì¹­ ì„¹ì…˜ -->
            <div id="sectionMatching" class="hidden">
                <h1 class="page-title">ì¸í”Œë£¨ì–¸ì„œ ë§¤ì¹­</h1>
                
                <!-- ìƒí’ˆ ì„ íƒ -->
                <div class="card">
                    <div class="card-header">ìƒí’ˆ ì„ íƒ</div>
                    <div class="card-body">
                        <div class="matching-product-select">
                            <select id="matchingProductSelect" onchange="updateMatching()">
                                <option value="">ìƒí’ˆì„ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div id="selectedProductInfo" class="selected-product-info hidden">
                            <div class="selected-product-image">
                                <img id="selectedProductImg" src="" alt="">
                            </div>
                            <div class="selected-product-details">
                                <h3 id="selectedProductName"></h3>
                                <p id="selectedProductCategory"></p>
                                <p id="selectedProductPrice"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì¸í”Œë£¨ì–¸ì„œ í•„í„° -->
                <div class="card">
                    <div class="card-header">ì¸í”Œë£¨ì–¸ì„œ í•„í„°</div>
                    <div class="card-body">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label>ì±„ë„</label>
                                <select id="matchingChannelFilter" onchange="updateMatching()">
                                    <option value="all">ì „ì²´ ì±„ë„</option>
                                    <option value="instagram">Instagram</option>
                                    <option value="youtube">YouTube</option>
                                    <option value="blog">ë¸”ë¡œê·¸</option>
                                    <option value="tiktok">TikTok</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>ì¹´í…Œê³ ë¦¬</label>
                                <select id="matchingCategoryFilter" onchange="updateMatching()">
                                    <option value="all">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                                    <option value="dessert">ë””ì €íŠ¸/ìŒì‹</option>
                                    <option value="beauty">ë·°í‹°</option>
                                    <option value="fashion">íŒ¨ì…˜</option>
                                    <option value="living">ìƒí™œìš©í’ˆ</option>
                                    <option value="electronics">ì „ìê¸°ê¸°</option>
                                    <option value="kids">ìœ¡ì•„/í‚¤ì¦ˆ</option>
                                    <option value="health">ê±´ê°•/í—¬ìŠ¤</option>
                                    <option value="pet">ë°˜ë ¤ë™ë¬¼</option>
                                    <option value="travel">ì—¬í–‰</option>
                                    <option value="interior">ì¸í…Œë¦¬ì–´</option>
                                    <option value="book">ë„ì„œ/êµìœ¡</option>
                                    <option value="hobby">ì·¨ë¯¸/ê²Œì„</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>ì •ë ¬</label>
                                <select id="matchingSortFilter" onchange="updateMatching()">
                                    <option value="match">ë§¤ì¹­ë¥  ë†’ì€ìˆœ</option>
                                    <option value="sales">íŒë§¤ ë§ì€ìˆœ</option>
                                    <option value="recent">ìµœê·¼ ê°€ì…ìˆœ</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>í™œë™ ìƒíƒœ</label>
                                <select id="matchingStatusFilter" onchange="updateMatching()">
                                    <option value="all">ì „ì²´</option>
                                    <option value="active">í™œë™ì¤‘ (íŒë§¤ ìˆìŒ)</option>
                                    <option value="inactive">ë¯¸í™œë™</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ë§¤ì¹­ ê²°ê³¼ -->
                <div class="card">
                    <div class="card-header">
                        <span>ì¶”ì²œ ì¸í”Œë£¨ì–¸ì„œ</span>
                        <span id="matchingResultCount" style="font-weight:normal;color:var(--text-light);margin-left:8px">0ëª…</span>
                    </div>
                    <div class="card-body" style="padding:0">
                        <div id="matchingResults" class="matching-results">
                            <div class="empty-matching">ìƒí’ˆì„ ì„ íƒí•˜ë©´ ë§¤ì¹­ë˜ëŠ” ì¸í”Œë£¨ì–¸ì„œë¥¼ ì¶”ì²œí•´ë“œë ¤ìš”</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="sectionAnalytics" class="hidden">
                <h1 class="page-title">ì„±ê³¼ë¶„ì„</h1>
                
                <!-- ìš”ì•½ ì¹´ë“œ -->
                <div class="stats-grid" style="margin-bottom:24px">
                    <div class="stat-card">
                        <div class="stat-label">ì´ ì¸í”Œë£¨ì–¸ì„œ</div>
                        <div class="stat-value" id="analyticsTotalInfluencers">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">í™œë™ ì¸í”Œë£¨ì–¸ì„œ</div>
                        <div class="stat-value" id="analyticsActiveInfluencers">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">í‰ê·  ë§¤ì¶œ/ì¸</div>
                        <div class="stat-value" id="analyticsAvgSales">â‚©0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ì´ë²ˆ ë‹¬ ì´ ë§¤ì¶œ</div>
                        <div class="stat-value" id="analyticsMonthSales">â‚©0</div>
                    </div>
                </div>

                <!-- TOP ì¸í”Œë£¨ì–¸ì„œ -->
                <div class="card">
                    <div class="card-header">TOP ì¸í”Œë£¨ì–¸ì„œ (ë§¤ì¶œ ìˆœìœ„)</div>
                    <table>
                        <thead><tr><th>ìˆœìœ„</th><th>ì´ë¦„</th><th>ì±„ë„</th><th>íŒë§¤ê±´ìˆ˜</th><th>ì´ ë§¤ì¶œ</th><th>ì´ ìˆ˜ìµ</th><th>ìµœê·¼ íŒë§¤</th></tr></thead>
                        <tbody id="topInfluencersTable"></tbody>
                    </table>
                </div>

                <!-- ì¹´í…Œê³ ë¦¬ë³„ ì„±ê³¼ -->
                <div class="card">
                    <div class="card-header">ì¹´í…Œê³ ë¦¬ë³„ ì„±ê³¼</div>
                    <table>
                        <thead><tr><th>ì¹´í…Œê³ ë¦¬</th><th>íŒë§¤ê±´ìˆ˜</th><th>ì´ ë§¤ì¶œ</th><th>TOP ì¸í”Œë£¨ì–¸ì„œ</th><th>ìƒí’ˆ ìˆ˜</th></tr></thead>
                        <tbody id="categoryAnalyticsTable"></tbody>
                    </table>
                </div>

                <!-- ì±„ë„ë³„ ì„±ê³¼ -->
                <div class="card">
                    <div class="card-header">ì±„ë„ë³„ ì„±ê³¼</div>
                    <table>
                        <thead><tr><th>ì±„ë„</th><th>ì¸í”Œë£¨ì–¸ì„œ ìˆ˜</th><th>ì´ íŒë§¤ê±´ìˆ˜</th><th>ì´ ë§¤ì¶œ</th><th>í‰ê·  ë§¤ì¶œ/ì¸</th></tr></thead>
                        <tbody id="channelAnalyticsTable"></tbody>
                    </table>
                </div>

                <!-- ì¸í”Œë£¨ì–¸ì„œ ìƒì„¸ DB -->
                <div class="card">
                    <div class="card-header">
                        ì¸í”Œë£¨ì–¸ì„œ ìƒì„¸ DB
                        <select id="analyticsFilter" onchange="updateAnalytics()" style="margin-left:12px;padding:4px 8px;font-size:12px">
                            <option value="all">ì „ì²´</option>
                            <option value="active">í™œë™ì¤‘ (íŒë§¤ ìˆìŒ)</option>
                            <option value="inactive">ë¯¸í™œë™ (íŒë§¤ ì—†ìŒ)</option>
                        </select>
                        <select id="analyticsCategoryFilter" onchange="updateAnalytics()" style="margin-left:8px;padding:4px 8px;font-size:12px">
                            <option value="all">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                            <option value="dessert">ë””ì €íŠ¸/ìŒì‹</option>
                            <option value="beauty">ë·°í‹°</option>
                            <option value="fashion">íŒ¨ì…˜</option>
                            <option value="living">ìƒí™œìš©í’ˆ</option>
                            <option value="electronics">ì „ìê¸°ê¸°</option>
                            <option value="kids">ìœ¡ì•„/í‚¤ì¦ˆ</option>
                            <option value="health">ê±´ê°•/í—¬ìŠ¤</option>
                            <option value="pet">ë°˜ë ¤ë™ë¬¼</option>
                            <option value="travel">ì—¬í–‰</option>
                            <option value="interior">ì¸í…Œë¦¬ì–´</option>
                            <option value="book">ë„ì„œ/êµìœ¡</option>
                            <option value="hobby">ì·¨ë¯¸/ê²Œì„</option>
                        </select>
                    </div>
                    <table>
                        <thead><tr><th>ì´ë¦„</th><th>ì—°ë½ì²˜</th><th>ì±„ë„</th><th>ê´€ì‹¬ ì¹´í…Œê³ ë¦¬</th><th>íŒë§¤ê±´ìˆ˜</th><th>ì´ ë§¤ì¶œ</th><th>ê°€ì…ì¼</th><th>ë©”ëª¨</th></tr></thead>
                        <tbody id="influencerDBTable"></tbody>
                    </table>
                </div>
            </div>

            <div id="sectionProducts" class="hidden">
                <h1 class="page-title">ìƒí’ˆ ê´€ë¦¬</h1>
                
                <!-- ì—°ë™ ì•ˆë‚´ -->
                <div class="card" style="background:linear-gradient(135deg,#e8f5e9 0%,#c8e6c9 100%);border:none;margin-bottom:16px">
                    <div class="card-body" style="padding:16px 20px">
                        <div style="display:flex;align-items:center;gap:12px">
                            <span style="font-size:18px;color:#2e7d32;font-weight:bold">â—</span>
                            <div>
                                <strong style="color:#2e7d32">ì‹¤ì‹œê°„ ì—°ë™ë¨</strong>
                                <p style="font-size:12px;color:#558b2f;margin-top:2px">ì—¬ê¸°ì„œ ë“±ë¡í•œ ìƒí’ˆì€ ì¸í”Œë£¨ì–¸ì„œ í˜ì´ì§€ì— ìë™ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header" id="productFormHeader">ìƒí’ˆ ë“±ë¡</div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="input-group"><label>ìƒí’ˆëª… <span style="color:#d93025">*</span></label><input type="text" id="productName" placeholder="ìƒí’ˆëª…"></div>
                            <div class="input-group"><label>ê°€ê²© <span style="color:#d93025">*</span></label><input type="number" id="productPrice" placeholder="ê°€ê²©"></div>
                            <div class="input-group"><label>ì¹´í…Œê³ ë¦¬ <span style="color:#d93025">*</span></label>
                                <select id="productCategory">
                                    <option value="">ì„ íƒ</option>
                                    <option value="dessert">ğŸª ë””ì €íŠ¸/ìŒì‹</option>
                                    <option value="beauty">ğŸ’„ ë·°í‹°</option>
                                    <option value="fashion">ğŸ‘— íŒ¨ì…˜</option>
                                    <option value="living">ğŸ  ìƒí™œìš©í’ˆ</option>
                                    <option value="electronics">ì „ìê¸°ê¸°</option>
                                    <option value="kids">ğŸ‘¶ ìœ¡ì•„/í‚¤ì¦ˆ</option>
                                    <option value="health">ğŸ’ª ê±´ê°•/í—¬ìŠ¤</option>
                                    <option value="pet">ğŸ¶ ë°˜ë ¤ë™ë¬¼</option>
                                    <option value="travel">âœˆï¸ ì—¬í–‰</option>
                                    <option value="interior">ğŸ›‹ï¸ ì¸í…Œë¦¬ì–´</option>
                                    <option value="book">ğŸ“š ë„ì„œ/êµìœ¡</option>
                                    <option value="hobby">ğŸ® ì·¨ë¯¸/ê²Œì„</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row" style="margin-top:12px">
                            <div class="input-group"><label>ë§í¬</label><input type="text" id="productLink" placeholder="https://..."></div>
                        </div>
                        <div class="form-row" style="margin-top:12px;align-items:flex-end">
                            <div class="input-group" style="flex:1">
                                <label>ì¸ë„¤ì¼ ì´ë¯¸ì§€</label>
                                <div style="display:flex;gap:8px;align-items:center">
                                    <input type="text" id="productImage" placeholder="https://ì´ë¯¸ì§€ì£¼ì†Œ.jpg" style="flex:1">
                                    <label for="productImageFile" class="btn btn-secondary btn-small" style="cursor:pointer;white-space:nowrap">ğŸ“· íŒŒì¼ ì„ íƒ</label>
                                    <input type="file" id="productImageFile" accept="image/*" style="display:none" onchange="handleProductImageUpload(event)">
                                </div>
                            </div>
                            <div id="productImagePreview" style="width:60px;height:60px;border-radius:8px;background:var(--bg-secondary);display:none;overflow:hidden;flex-shrink:0">
                                <img id="productImagePreviewImg" style="width:100%;height:100%;object-fit:cover">
                            </div>
                        </div>
                        <div class="form-row" style="margin-top:12px">
                            <div class="input-group" style="max-width:150px"><label>ì‹œì‘ì¼</label><input type="date" id="productStartDate"></div>
                            <div class="input-group" style="max-width:150px"><label>ì¢…ë£Œì¼</label><input type="date" id="productEndDate"></div>
                        </div>
                        <p style="font-size:11px;color:var(--text-light);margin-top:12px">ğŸ’¡ ì¸í”Œë£¨ì–¸ì„œ ìˆ˜ìµ = ê°€ê²©ì˜ 10% (ë“±ê¸‰ì— ë”°ë¼ 8~15%)</p>
                        <div style="margin-top:16px;display:flex;gap:8px">
                            <button class="btn btn-primary" id="productSubmitBtn" onclick="addProduct()">ë“±ë¡</button>
                            <button class="btn btn-secondary hidden" id="productCancelBtn" onclick="cancelEditProduct()">ì·¨ì†Œ</button>
                        </div>
                        <input type="hidden" id="editProductId" value="">
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">ë“±ë¡ëœ ìƒí’ˆ <span id="productCount" style="color:var(--text-light);font-weight:400;font-size:13px"></span></div>
                    <table><thead><tr><th style="width:60px">ì¸ë„¤ì¼</th><th>ìƒí’ˆ</th><th>ì¹´í…Œê³ ë¦¬</th><th>ê°€ê²©</th><th>ìˆ˜ìµ</th><th>ê¸°ê°„</th><th>ê´€ë¦¬</th></tr></thead><tbody id="productsTable"></tbody></table>
                </div>
            </div>

            <div id="sectionSales" class="hidden">
                <h1 class="page-title">íŒë§¤ ì…ë ¥</h1>
                <div class="card">
                    <div class="card-header">íŒë§¤ ë“±ë¡</div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="input-group"><label>ìƒí’ˆ</label><select id="saleProduct"></select></div>
                            <div class="input-group"><label>ì¸í”Œë£¨ì–¸ì„œ</label><select id="saleInfluencer"></select></div>
                            <div class="input-group"><label>ìˆ˜ëŸ‰</label><input type="number" id="saleQty" value="1"></div>
                            <div class="input-group"><label>ê¸ˆì•¡</label><input type="number" id="saleAmount" placeholder="ê¸ˆì•¡"></div>
                            <button class="btn btn-primary" onclick="addSale()">ë“±ë¡</button>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">íŒë§¤ ë‚´ì—­</div>
                    <table><thead><tr><th>ë‚ ì§œ</th><th>ìƒí’ˆ</th><th>ì¸í”Œë£¨ì–¸ì„œ</th><th>ìˆ˜ëŸ‰</th><th>ê¸ˆì•¡</th><th>ìˆ˜ìµ</th><th>ê´€ë¦¬</th></tr></thead><tbody id="allSalesTable"></tbody></table>
                </div>
            </div>
        </main>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyCwLyZIgM2NXDj8Wt1s8leqvmmHK8qzMN8",
            authDomain: "hotdeal-influencer.firebaseapp.com",
            projectId: "hotdeal-influencer",
            storageBucket: "hotdeal-influencer.firebasestorage.app",
            messagingSenderId: "197211467878",
            appId: "1:197211467878:web:0980b331a9d0e787cafda7"
        };
        
        let db = null;
        
        function initFirebase() {
            if (typeof firebase !== 'undefined') {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                console.log('Firebase ì´ˆê¸°í™” ì™„ë£Œ');
            } else {
                setTimeout(initFirebase, 100);
            }
        }
        initFirebase();

        const ADMIN_ID = 'admin', ADMIN_PW = 'hotdeal1234';
        let data = { 
            users: [], 
            products: [{id:1, name:'ë‘ì«€ì¿  í”¼ìŠ¤íƒ€ì¹˜ì˜¤ ì˜¤ë¦¬ì§€ë„ ì¹´ë‹¤ì´í”„ ìˆ˜ì œ ë””ì €íŠ¸', price:29900, link:'https://smartstore.naver.com/gardenings/products/12913776103', category:'dessert', image:'https://i.imgur.com/YqVqQJd.jpeg', startDate:'2025-01-21', endDate:'2025-01-28'}], 
            sales: [] 
        };
        
        // ì¸í”Œë£¨ì–¸ì„œ ë“±ê¸‰ ì‹œìŠ¤í…œ
        const gradeSystem = [
            { id: 'seed', name: 'ì”¨ì•—', icon: 'ğŸŒ±', minSales: 0, commission: 8, color: '#8B4513', bgColor: '#FFF8DC', benefit: 'ì¼ë°˜ ìƒí’ˆ' },
            { id: 'sprout', name: 'ìƒˆì‹¹', icon: 'ğŸŒ¿', minSales: 5, commission: 9, color: '#228B22', bgColor: '#F0FFF0', benefit: 'ì‹ ìƒí’ˆ 1ì¼ ì„ ê³µê°œ' },
            { id: 'bronze', name: 'ë¸Œë¡ ì¦ˆ', icon: 'ğŸ¥‰', minSales: 20, commission: 10, color: '#CD7F32', bgColor: '#FDF5E6', benefit: 'ì‹ ìƒí’ˆ 3ì¼ ì„ ê³µê°œ' },
            { id: 'silver', name: 'ì‹¤ë²„', icon: 'ğŸ¥ˆ', minSales: 50, commission: 11, color: '#C0C0C0', bgColor: '#F5F5F5', benefit: 'ì „ìš© ìƒí’ˆ ì ‘ê·¼' },
            { id: 'gold', name: 'ê³¨ë“œ', icon: 'ğŸ¥‡', minSales: 100, commission: 12, color: '#FFD700', bgColor: '#FFFACD', benefit: 'í”„ë¦¬ë¯¸ì—„ ìƒí’ˆ ì ‘ê·¼' },
            { id: 'diamond', name: 'ë‹¤ì´ì•„', icon: 'ğŸ’', minSales: 300, commission: 13, color: '#00CED1', bgColor: '#E0FFFF', benefit: 'í•œì •íŒ ìš°ì„  ì ‘ê·¼' },
            { id: 'master', name: 'ë§ˆìŠ¤í„°', icon: 'ğŸ‘‘', minSales: 500, commission: 15, color: '#9400D3', bgColor: '#F8F0FF', benefit: 'VIP ì „ìš© ë”œ' }
        ];
        
        // ë“±ê¸‰ ê³„ì‚° í•¨ìˆ˜
        function getUserGrade(totalSales) {
            let grade = gradeSystem[0];
            for (let i = gradeSystem.length - 1; i >= 0; i--) {
                if (totalSales >= gradeSystem[i].minSales) {
                    grade = gradeSystem[i];
                    break;
                }
            }
            return grade;
        }
        
        // ë‹¤ìŒ ë“±ê¸‰ê¹Œì§€ ë‚¨ì€ íŒë§¤ ìˆ˜
        function getNextGradeInfo(totalSales) {
            for (let i = 0; i < gradeSystem.length; i++) {
                if (totalSales < gradeSystem[i].minSales) {
                    return {
                        nextGrade: gradeSystem[i],
                        remaining: gradeSystem[i].minSales - totalSales
                    };
                }
            }
            return null;
        }

        // Firebaseì—ì„œ ë°ì´í„° ë¡œë“œ
        async function loadData() {
            if (!db) {
                console.log('Firebase not ready, retrying...');
                setTimeout(loadData, 100);
                return;
            }
            
            try {
                console.log('Firebaseì—ì„œ ë°ì´í„° ë¡œë“œ ì¤‘...');
                
                // Users ë¡œë“œ
                const usersSnapshot = await db.collection('users').get();
                data.users = usersSnapshot.docs.map(doc => ({ 
                    id: doc.id, 
                    visibleId: doc.id, 
                    ...doc.data() 
                }));
                console.log('Users ë¡œë“œ ì™„ë£Œ:', data.users.length, 'ëª…');
                
                // Sales ë¡œë“œ
                const salesSnapshot = await db.collection('sales').get();
                data.sales = salesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log('Sales ë¡œë“œ ì™„ë£Œ:', data.sales.length, 'ê±´');
                
                // Products ë¡œë“œ
                const productsSnapshot = await db.collection('products').get();
                if (!productsSnapshot.empty) {
                    data.products = productsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                }
                console.log('Products ë¡œë“œ ì™„ë£Œ:', data.products.length, 'ê°œ');
                
            } catch (error) {
                console.error('Firebase ë¡œë“œ ì‹¤íŒ¨:', error);
                // ë¡œì»¬ ë°ì´í„° ë°±ì—… ì‚¬ìš©
                const saved = localStorage.getItem('hotdealInfluencerData');
                if (saved) { 
                    const p = JSON.parse(saved); 
                    data.users = p.users || []; 
                    data.sales = p.sales || []; 
                    if (p.products?.length) data.products = p.products; 
                }
            }
        }
        
        // Firebaseì— ë°ì´í„° ì €ì¥
        async function saveUserToFirebase(user) {
            if (!db) return;
            try {
                const docId = user.googleEmail || user.id;
                await db.collection('users').doc(docId).set(user, { merge: true });
                console.log('User saved to Firebase:', docId);
            } catch (error) {
                console.error('Firebase ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }
        
        async function saveProductToFirebase(product) {
            if (!db) return;
            try {
                await db.collection('products').doc(String(product.id)).set(product);
                console.log('Product saved to Firebase');
            } catch (error) {
                console.error('Firebase ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }
        
        async function deleteProductFromFirebase(productId) {
            if (!db) return;
            try {
                await db.collection('products').doc(String(productId)).delete();
                console.log('Product deleted from Firebase');
            } catch (error) {
                console.error('Firebase ì‚­ì œ ì‹¤íŒ¨:', error);
            }
        }
        
        async function saveSaleToFirebase(sale) {
            if (!db) return;
            try {
                await db.collection('sales').doc(String(sale.id)).set(sale);
                console.log('Sale saved to Firebase');
            } catch (error) {
                console.error('Firebase ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }
        
        async function deleteSaleFromFirebase(saleId) {
            if (!db) return;
            try {
                await db.collection('sales').doc(String(saleId)).delete();
                console.log('Sale deleted from Firebase');
            } catch (error) {
                console.error('Firebase ì‚­ì œ ì‹¤íŒ¨:', error);
            }
        }
        
        // ë¡œì»¬ ë°±ì—…
        function saveDataLocal() { 
            localStorage.setItem('hotdealInfluencerData', JSON.stringify(data)); 
        }
        
        function generateCode() { 
            let c; 
            do { 
                c = 'HD' + Math.floor(1000 + Math.random() * 9000); 
            } while (data.users.find(u => u.code === c)); 
            return c; 
        }

        async function login() {
            try {
                if (document.getElementById('adminId').value === ADMIN_ID && document.getElementById('adminPw').value === ADMIN_PW) {
                    document.getElementById('loginPage').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    await loadData();
                    updateAll();
                } else { 
                    showToast('ID ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë¦½ë‹ˆë‹¤', 'error'); 
                }
            } catch (error) {
                console.error('Login error:', error);
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
            }
        }
        
        function logout() { 
            document.getElementById('dashboard').classList.add('hidden'); 
            document.getElementById('loginPage').classList.remove('hidden'); 
        }

        function showSection(section, el) {
            ['sectionOverview','sectionApplications','sectionInfluencers','sectionInfluencerDB','sectionMatching','sectionAnalytics','sectionProducts','sectionSales'].forEach(s => document.getElementById(s).classList.add('hidden'));
            document.getElementById('section' + section.charAt(0).toUpperCase() + section.slice(1)).classList.remove('hidden');
            document.querySelectorAll('.sidebar-menu a').forEach(a => a.classList.remove('active'));
            if (el) el.classList.add('active');
            if (section === 'analytics') {
                updateAnalytics();
            } else if (section === 'influencerDB') {
                renderInfluencerDB();
            } else if (section === 'matching') {
                initMatchingSection();
            } else {
                updateAll();
            }
        }

        // ëª¨ë°”ì¼ ì‚¬ì´ë“œë°” ì—´ê¸°/ë‹«ê¸°
        function openMobileSidebar() {
            document.getElementById('mobileSidebarOverlay').classList.add('show');
            document.body.style.overflow = 'hidden';
        }
        
        function closeMobileSidebar() {
            document.getElementById('mobileSidebarOverlay').classList.remove('show');
            document.body.style.overflow = '';
        }
        
        // ëª¨ë°”ì¼ìš© ì„¹ì…˜ ì „í™˜
        function showSectionMobile(section, el) {
            // ë°ìŠ¤í¬íƒ‘ í•¨ìˆ˜ ì‹¤í–‰
            showSection(section, null);
            
            // ëª¨ë°”ì¼ ë©”ë‰´ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.mobile-sidebar-menu a').forEach(a => a.classList.remove('active'));
            if (el) el.classList.add('active');
            
            // ì‚¬ì´ë“œë°” ë‹«ê¸°
            closeMobileSidebar();
            
            // ìŠ¤í¬ë¡¤ ë§¨ ìœ„ë¡œ
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }


        function updateAll() {
            try {
                const pending = data.users.filter(u => u.status === 'pending');
                const approved = data.users.filter(u => u.status === 'approved');
                const now = new Date();
                
                // ì´ë²ˆ ë‹¬ ë°ì´í„°
                const monthSales = data.sales.filter(s => {
                    const d = new Date(s.date);
                    return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
                });
                
                document.getElementById('pendingCount').textContent = pending.length;
                document.getElementById('activeCount').textContent = approved.length;
                document.getElementById('monthSales').textContent = 'â‚©' + monthSales.reduce((s,x) => s + (x.amount || 0), 0).toLocaleString();
                document.getElementById('monthCommission').textContent = 'â‚©' + monthSales.reduce((s,x) => s + (x.commission || 0), 0).toLocaleString();
                
                // ìŠ¹ì¸ ëŒ€ê¸° ë±ƒì§€
                const pendingBadge = document.getElementById('pendingBadge');
                if (pendingBadge) {
                    pendingBadge.textContent = pending.length;
                    pendingBadge.style.display = pending.length > 0 ? 'inline' : 'none';
                }

                // ì˜¤ëŠ˜ì˜ í•  ì¼
                updateTodoList(pending, approved);
                
                // ë“±ê¸‰ë³„ í˜„í™©
                updateGradeDistribution(approved);
                
                // ë§¤ì¹­ ì¶”ì²œ
                updateMatchRecommendations(approved);
                
                // TOP ì¸í”Œë£¨ì–¸ì„œ
                updateTopInfluencers(approved);

            // ìµœê·¼ í™œë™
            document.getElementById('recentSalesTable').innerHTML = data.sales.length === 0 
                ? '<tr><td colspan="5" class="empty">íŒë§¤ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>'
                : data.sales.slice(-7).reverse().map(s => {
                    const timeAgo = getTimeAgo(new Date(s.date));
                    return `<tr><td>${timeAgo}</td><td>íŒë§¤</td><td><span class="badge badge-primary">${s.userName}</span></td><td>${s.productName}</td><td style="color:var(--success)">â‚©${(s.amount || 0).toLocaleString()}</td></tr>`;
                }).join('');

            // ê°€ì… ì‹ ì²­
            document.getElementById('applicationsTable').innerHTML = pending.length === 0 
                ? '<tr><td colspan="6" class="empty">ëŒ€ê¸° ì¤‘ì¸ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>'
                : pending.map(u => {
                    const ch = [u.channels?.youtube && 'YT', u.channels?.instagram && 'IG', u.channels?.tiktok && 'TT', u.channels?.blog && 'Blog'].filter(Boolean).join(', ');
                    const docId = u.googleEmail || u.id;
                    // ì±„ë„ URL ë§í¬ ìƒì„±
                    let channelLinks = [];
                    if (u.channelUrls?.youtube) channelLinks.push(`<a href="${u.channelUrls.youtube}" target="_blank" style="color:var(--primary);font-size:11px">YT</a>`);
                    if (u.channelUrls?.instagram) channelLinks.push(`<a href="${u.channelUrls.instagram}" target="_blank" style="color:var(--primary);font-size:11px">IG</a>`);
                    if (u.channelUrls?.blog) channelLinks.push(`<a href="${u.channelUrls.blog}" target="_blank" style="color:var(--primary);font-size:11px">Blog</a>`);
                    if (u.channelUrls?.tiktok) channelLinks.push(`<a href="${u.channelUrls.tiktok}" target="_blank" style="color:var(--primary);font-size:11px">TT</a>`);
                    const urlLinks = channelLinks.length > 0 ? `<br>${channelLinks.join(' | ')}` : '';
                    return `<tr><td>${new Date(u.createdAt).toLocaleDateString('ko-KR')}</td><td>${u.googleEmail || u.visibleId || '-'}</td><td>${u.name}</td><td>${u.contact || '-'}</td><td>${ch || '-'}${urlLinks}</td><td><button class="btn btn-success btn-small" onclick="approveUser('${docId}')">ìŠ¹ì¸</button> <button class="btn btn-danger btn-small" onclick="rejectUser('${docId}')">ê±°ì ˆ</button></td></tr>`;
                }).join('');

            // ì¸í”Œë£¨ì–¸ì„œ
            document.getElementById('influencersTable').innerHTML = approved.length === 0 
                ? '<tr><td colspan="6" class="empty">ìŠ¹ì¸ëœ ì¸í”Œë£¨ì–¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>'
                : approved.map(u => {
                    const s = data.sales.filter(x => x.userCode === u.code);
                    const ch = [u.channels?.youtube && 'YT', u.channels?.instagram && 'IG', u.channels?.tiktok && 'TT', u.channels?.blog && 'Blog'].filter(Boolean).join(', ');
                    // ì±„ë„ URL ë§í¬ ìƒì„±
                    let channelLinks = [];
                    if (u.channelUrls?.youtube) channelLinks.push(`<a href="${u.channelUrls.youtube}" target="_blank" style="color:var(--primary);font-size:11px">YT</a>`);
                    if (u.channelUrls?.instagram) channelLinks.push(`<a href="${u.channelUrls.instagram}" target="_blank" style="color:var(--primary);font-size:11px">IG</a>`);
                    if (u.channelUrls?.blog) channelLinks.push(`<a href="${u.channelUrls.blog}" target="_blank" style="color:var(--primary);font-size:11px">Blog</a>`);
                    if (u.channelUrls?.tiktok) channelLinks.push(`<a href="${u.channelUrls.tiktok}" target="_blank" style="color:var(--primary);font-size:11px">TT</a>`);
                    const urlLinks = channelLinks.length > 0 ? `<br>${channelLinks.join(' | ')}` : '';
                    return `<tr><td>${u.name}</td><td><span class="badge badge-primary">${u.code}</span></td><td>${ch || '-'}${urlLinks}</td><td>${s.reduce((a,x)=>a+(x.quantity||0),0)}ê±´</td><td>â‚©${s.reduce((a,x)=>a+(x.amount||0),0).toLocaleString()}</td><td style="color:var(--success)">â‚©${s.reduce((a,x)=>a+(x.commission||0),0).toLocaleString()}</td></tr>`;
                }).join('');

            // ìƒí’ˆ ê°œìˆ˜ í‘œì‹œ
            const productCountEl = document.getElementById('productCount');
            if (productCountEl) {
                productCountEl.textContent = `(ì´ ${data.products.length}ê°œ)`;
            }
            
            // ìƒí’ˆ
            document.getElementById('productsTable').innerHTML = data.products.length === 0 
                ? '<tr><td colspan="7" class="empty">ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤</td></tr>'
                : data.products.map(p => {
                    const thumb = p.image ? `<img src="${p.image}" style="width:50px;height:50px;object-fit:cover;border-radius:4px">` : `<div style="width:50px;height:50px;background:var(--bg-secondary);border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:12px;color:var(--text-light)">ì—†ìŒ</div>`;
                    const startDate = p.startDate ? new Date(p.startDate).toLocaleDateString('ko-KR', {month:'short', day:'numeric'}) : '-';
                    const endDate = p.endDate ? new Date(p.endDate).toLocaleDateString('ko-KR', {month:'short', day:'numeric'}) : '-';
                    return `<tr>
                        <td>${thumb}</td>
                        <td><strong>${p.name}</strong><br><a href="${p.link}" target="_blank" style="font-size:11px;color:var(--primary)">ë§í¬ ì—´ê¸°</a></td>
                        <td>${categoryNames[p.category] || p.category || '-'}</td>
                        <td>â‚©${(p.price || 0).toLocaleString()}</td>
                        <td style="color:var(--success)">â‚©${Math.floor((p.price || 0)*0.1).toLocaleString()}</td>
                        <td style="font-size:12px">${startDate} ~ ${endDate}</td>
                        <td>
                            <button class="btn btn-small" style="background:var(--primary-light);color:var(--primary);margin-right:4px" onclick="editProduct('${p.id}')">ìˆ˜ì •</button>
                            <button class="btn btn-danger btn-small" onclick="deleteProduct('${p.id}')">ì‚­ì œ</button>
                        </td>
                    </tr>`;
                }).join('');

            // ë“œë¡­ë‹¤ìš´
            document.getElementById('saleProduct').innerHTML = '<option value="">ì„ íƒ</option>' + data.products.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
            document.getElementById('saleInfluencer').innerHTML = '<option value="">ì„ íƒ</option>' + approved.map(u => `<option value="${u.code}">${u.name} (${u.code})</option>`).join('');

            // íŒë§¤ ë‚´ì—­
            document.getElementById('allSalesTable').innerHTML = data.sales.length === 0 
                ? '<tr><td colspan="7" class="empty">íŒë§¤ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>'
                : data.sales.slice().reverse().map(s => `<tr><td>${new Date(s.date).toLocaleDateString('ko-KR')}</td><td>${s.productName}</td><td>${s.userName}</td><td>${s.quantity || 0}ê°œ</td><td>â‚©${(s.amount || 0).toLocaleString()}</td><td style="color:var(--success)">â‚©${(s.commission || 0).toLocaleString()}</td><td><button class="btn btn-danger btn-small" onclick="deleteSale('${s.id}')">ì‚­ì œ</button></td></tr>`).join('');
            } catch (error) {
                console.error('updateAll error:', error);
            }
        }

        async function approveUser(docId) { 
            const u = data.users.find(x => (x.googleEmail || x.id) === docId); 
            if (u) { 
                u.status = 'approved'; 
                u.code = generateCode(); 
                await saveUserToFirebase(u);
                saveDataLocal(); 
                updateAll(); 
                showToast('' + u.name + 'ë‹˜ ìŠ¹ì¸! ì½”ë“œ: ' + u.code); 
            } 
        }
        
        async function rejectUser(docId) { 
            if (!confirm('ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return; 
            const u = data.users.find(x => (x.googleEmail || x.id) === docId); 
            if (u) { 
                u.status = 'rejected'; 
                await saveUserToFirebase(u);
                saveDataLocal(); 
                updateAll(); 
                showToast('ê±°ì ˆë¨'); 
            } 
        }
        
        // ì¹´í…Œê³ ë¦¬ ë§¤í•‘
        const categoryNames = {
            dessert: 'ë””ì €íŠ¸/ìŒì‹', beauty: 'ë·°í‹°', fashion: 'íŒ¨ì…˜', living: 'ìƒí™œìš©í’ˆ',
            electronics: 'ì „ìê¸°ê¸°', kids: 'ìœ¡ì•„/í‚¤ì¦ˆ', health: 'ê±´ê°•/í—¬ìŠ¤', pet: 'ë°˜ë ¤ë™ë¬¼',
            travel: 'ì—¬í–‰', interior: 'ì¸í…Œë¦¬ì–´', book: 'ë„ì„œ/êµìœ¡', hobby: 'ì·¨ë¯¸/ê²Œì„'
        };
        
        // ì‹œê°„ í‘œì‹œ í•¨ìˆ˜
        function getTimeAgo(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return 'ë°©ê¸ˆ ì „';
            if (minutes < 60) return minutes + 'ë¶„ ì „';
            if (hours < 24) return hours + 'ì‹œê°„ ì „';
            if (days < 7) return days + 'ì¼ ì „';
            return date.toLocaleDateString('ko-KR');
        }
        
        // ë“±ê¸‰ë³„ í˜„í™© ì—…ë°ì´íŠ¸
        function updateGradeDistribution(approved) {
            const container = document.getElementById('gradeDistribution');
            if (!container) return;
            
            // ë“±ê¸‰ë³„ ì¸í”Œë£¨ì–¸ì„œ ìˆ˜ ì§‘ê³„
            const gradeCount = {};
            gradeSystem.forEach(g => gradeCount[g.id] = 0);
            
            approved.forEach(u => {
                const userSales = data.sales.filter(s => s.userCode === u.code);
                const totalSales = userSales.reduce((sum, s) => sum + (s.quantity || 0), 0);
                const grade = getUserGrade(totalSales);
                gradeCount[grade.id]++;
            });
            
            const total = approved.length || 1;
            
            container.innerHTML = gradeSystem.map(g => {
                const count = gradeCount[g.id];
                const percent = Math.round((count / total) * 100);
                return `
                    <div class="grade-dist-item" style="background:${g.bgColor};color:${g.color}" onclick="filterByGrade('${g.id}')">
                        <div class="grade-dist-icon">${g.icon}</div>
                        <div class="grade-dist-name">${g.name}</div>
                        <div class="grade-dist-count">${count}ëª…</div>
                        <div class="grade-dist-percent">${percent}%</div>
                    </div>
                `;
            }).join('');
        }
        
        // ë“±ê¸‰ í•„í„°ë¡œ ì´ë™
        function filterByGrade(gradeId) {
            const gradeFilterEl = document.getElementById('dbGradeFilter');
            if (gradeFilterEl) {
                gradeFilterEl.value = gradeId;
            }
            showSection('influencerDB', document.querySelector('.sidebar-menu a:nth-child(4)'));
        }
        
        // ì˜¤ëŠ˜ì˜ í•  ì¼ ì—…ë°ì´íŠ¸
        function updateTodoList(pending, approved) {
            const container = document.getElementById('todoList');
            let html = '';
            
            // ìŠ¹ì¸ ëŒ€ê¸°
            if (pending.length > 0) {
                html += `<div class="todo-item urgent">
                    <div class="todo-icon">ğŸ””</div>
                    <div class="todo-content">
                        <div class="todo-title">${pending.length}ëª…ì˜ ê°€ì… ìŠ¹ì¸ ëŒ€ê¸° ì¤‘</div>
                        <div class="todo-desc">ìƒˆë¡œìš´ ì¸í”Œë£¨ì–¸ì„œê°€ ìŠ¹ì¸ì„ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”</div>
                    </div>
                    <button class="todo-action" onclick="showSection('applications', document.querySelectorAll('.sidebar-menu a')[1])">ìŠ¹ì¸í•˜ê¸°</button>
                </div>`;
            }
            
            // ë§¤ì¹­ ì•ˆ ëœ ì¸í”Œë£¨ì–¸ì„œ
            const unmatchedCount = approved.filter(u => !u.matchedProducts || u.matchedProducts.length === 0).length;
            if (unmatchedCount > 0) {
                html += `<div class="todo-item">
                    <div class="todo-icon">ğŸ¯</div>
                    <div class="todo-content">
                        <div class="todo-title">${unmatchedCount}ëª…ì—ê²Œ ìƒí’ˆ ë§¤ì¹­ í•„ìš”</div>
                        <div class="todo-desc">ì•„ì§ ì¶”ì²œ ìƒí’ˆì´ ì„¤ì •ë˜ì§€ ì•Šì€ ì¸í”Œë£¨ì–¸ì„œê°€ ìˆì–´ìš”</div>
                    </div>
                    <button class="todo-action" onclick="showSection('influencerDB', document.querySelectorAll('.sidebar-menu a')[3])">ë§¤ì¹­í•˜ê¸°</button>
                </div>`;
            }
            
            // ìƒí’ˆ ë“±ë¡ ìœ ë„
            if (data.products.length === 0) {
                html += `<div class="todo-item">
                    <div class="todo-icon">ğŸ“¦</div>
                    <div class="todo-content">
                        <div class="todo-title">ì²« ìƒí’ˆì„ ë“±ë¡í•´ë³´ì„¸ìš”</div>
                        <div class="todo-desc">ì¸í”Œë£¨ì–¸ì„œì—ê²Œ ì¶”ì²œí•  ìƒí’ˆì„ ë“±ë¡í•˜ì„¸ìš”</div>
                    </div>
                    <button class="todo-action" onclick="showSection('products', document.querySelectorAll('.sidebar-menu a')[5])">ë“±ë¡í•˜ê¸°</button>
                </div>`;
            }
            
            // ëª¨ë‘ ì™„ë£Œ
            if (html === '') {
                html = `<div class="todo-item success">
                    <div class="todo-icon">â—</div>
                    <div class="todo-content">
                        <div class="todo-title">ëª¨ë“  í•  ì¼ ì™„ë£Œ!</div>
                        <div class="todo-desc">ì˜¤ëŠ˜ë„ ìˆ˜ê³ í•˜ì…¨ì–´ìš”</div>
                    </div>
                </div>`;
            }
            
            container.innerHTML = html;
        }
        
        // ë§¤ì¹­ ì¶”ì²œ ì—…ë°ì´íŠ¸
        function updateMatchRecommendations(approved) {
            const container = document.getElementById('matchRecommendations');
            
            if (approved.length === 0 || data.products.length === 0) {
                container.innerHTML = '<p style="color:var(--text-light);text-align:center;padding:20px">ì¸í”Œë£¨ì–¸ì„œë‚˜ ìƒí’ˆì„ ë¨¼ì € ë“±ë¡í•˜ì„¸ìš”</p>';
                return;
            }
            
            // ë§¤ì¹­ ì¶”ì²œ ìƒì„±
            let recommendations = [];
            
            approved.forEach(u => {
                if (!u.categories) return;
                
                const userCats = Object.keys(u.categories).filter(k => u.categories[k]);
                
                data.products.forEach(p => {
                    if (userCats.includes(p.category)) {
                        // ì´ë¯¸ ë§¤ì¹­ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
                        if (u.matchedProducts && u.matchedProducts.includes(String(p.id))) return;
                        
                        recommendations.push({
                            user: u,
                            product: p,
                            reason: `${categoryNames[p.category]} ê´€ì‹¬ ì¹´í…Œê³ ë¦¬`
                        });
                    }
                });
            });
            
            // ìƒìœ„ 5ê°œë§Œ í‘œì‹œ
            recommendations = recommendations.slice(0, 5);
            
            if (recommendations.length === 0) {
                container.innerHTML = '<p style="color:var(--text-light);text-align:center;padding:20px">ìƒˆë¡œìš´ ë§¤ì¹­ ì¶”ì²œì´ ì—†ì–´ìš”</p>';
                return;
            }
            
            container.innerHTML = recommendations.map(r => `
                <div class="match-item">
                    <div class="match-avatar">${r.user.name.charAt(0)}</div>
                    <div class="match-info">
                        <div class="match-name">${r.user.name}</div>
                        <div class="match-reason">${r.reason}</div>
                    </div>
                    <div class="match-product">${r.product.name.slice(0,8)}${r.product.name.length > 8 ? '...' : ''}</div>
                </div>
            `).join('');
        }
        
        // TOP ì¸í”Œë£¨ì–¸ì„œ ì—…ë°ì´íŠ¸
        function updateTopInfluencers(approved) {
            const container = document.getElementById('topInfluencers');
            const now = new Date();
            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            // ì´ë²ˆ ì£¼ íŒë§¤ ì§‘ê³„
            const influencerStats = approved.map(u => {
                const weekSales = data.sales.filter(s => s.userCode === u.code && new Date(s.date) >= weekAgo);
                return {
                    ...u,
                    weekSalesCount: weekSales.reduce((sum, s) => sum + (s.quantity || 1), 0),
                    weekAmount: weekSales.reduce((sum, s) => sum + (s.amount || 0), 0)
                };
            }).filter(u => u.weekSalesCount > 0).sort((a, b) => b.weekAmount - a.weekAmount);
            
            if (influencerStats.length === 0) {
                container.innerHTML = '<p style="color:var(--text-light);text-align:center;padding:20px">ì´ë²ˆ ì£¼ íŒë§¤ ë°ì´í„°ê°€ ì—†ì–´ìš”</p>';
                return;
            }
            
            const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', '4', '5'];
            container.innerHTML = influencerStats.slice(0, 5).map((u, i) => `
                <div class="top-item">
                    <div class="top-rank">${medals[i]}</div>
                    <div class="top-avatar">${u.name.charAt(0)}</div>
                    <div class="top-info">
                        <div class="top-name">${u.name}</div>
                        <div class="top-stats">${u.weekSalesCount}ê±´ íŒë§¤</div>
                    </div>
                    <div class="top-amount">â‚©${u.weekAmount.toLocaleString()}</div>
                </div>
            `).join('');
        }

        // ìƒí’ˆ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬ (Base64ë¡œ ë³€í™˜)
        function handleProductImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // íŒŒì¼ í¬ê¸° ì²´í¬ (2MB ì œí•œ)
            if (file.size > 2 * 1024 * 1024) {
                showToast('ì´ë¯¸ì§€ëŠ” 2MB ì´í•˜ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64 = e.target.result;
                document.getElementById('productImage').value = base64;
                
                // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                document.getElementById('productImagePreview').style.display = 'block';
                document.getElementById('productImagePreviewImg').src = base64;
                
                showToast('ì´ë¯¸ì§€ê°€ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤');
            };
            reader.readAsDataURL(file);
        }
        
        // URL ì…ë ¥ì‹œ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            const imageInput = document.getElementById('productImage');
            if (imageInput) {
                imageInput.addEventListener('input', function() {
                    const url = this.value.trim();
                    if (url && (url.startsWith('http') || url.startsWith('data:'))) {
                        document.getElementById('productImagePreview').style.display = 'block';
                        document.getElementById('productImagePreviewImg').src = url;
                    } else {
                        document.getElementById('productImagePreview').style.display = 'none';
                    }
                });
            }
        });

        async function addProduct() {
            const editId = document.getElementById('editProductId').value;
            const name = document.getElementById('productName').value.trim();
            const price = parseInt(document.getElementById('productPrice').value) || 0;
            const link = document.getElementById('productLink').value.trim();
            const category = document.getElementById('productCategory').value;
            const image = document.getElementById('productImage').value.trim();
            const startDate = document.getElementById('productStartDate').value;
            const endDate = document.getElementById('productEndDate').value;
            
            if (!name || !price) { showToast('ìƒí’ˆëª…ê³¼ ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš”', 'error'); return; }
            if (!category) { showToast('ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”', 'error'); return; }
            
            if (editId) {
                // ìˆ˜ì • ëª¨ë“œ
                const product = data.products.find(p => String(p.id) === String(editId));
                if (product) {
                    product.name = name;
                    product.price = price;
                    product.link = link;
                    product.category = category;
                    product.image = image;
                    product.startDate = startDate || product.startDate;
                    product.endDate = endDate || product.endDate;
                    
                    await saveProductToFirebase(product);
                    saveDataLocal();
                    updateAll();
                    showToast('ìƒí’ˆ ìˆ˜ì •ë¨');
                    cancelEditProduct();
                }
            } else {
                // ë“±ë¡ ëª¨ë“œ
                const product = {
                    id: Date.now(), 
                    name, 
                    price, 
                    link, 
                    category,
                    image,
                    startDate: startDate || new Date().toISOString().split('T')[0],
                    endDate: endDate || new Date(Date.now() + 30*24*60*60*1000).toISOString().split('T')[0]
                };
                data.products.push(product);
                await saveProductToFirebase(product);
                saveDataLocal(); 
                updateAll(); 
                showToast('ìƒí’ˆ ë“±ë¡ë¨');
                clearProductForm();
            }
        }
        
        function editProduct(id) {
            const product = data.products.find(p => String(p.id) === String(id));
            if (!product) return;
            
            // í¼ì— ë°ì´í„° ì±„ìš°ê¸°
            document.getElementById('editProductId').value = id;
            document.getElementById('productName').value = product.name || '';
            document.getElementById('productPrice').value = product.price || '';
            document.getElementById('productLink').value = product.link || '';
            document.getElementById('productCategory').value = product.category || '';
            document.getElementById('productImage').value = product.image || '';
            document.getElementById('productStartDate').value = product.startDate || '';
            document.getElementById('productEndDate').value = product.endDate || '';
            
            // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
            if (product.image) {
                document.getElementById('productImagePreview').style.display = 'block';
                document.getElementById('productImagePreviewImg').src = product.image;
            } else {
                document.getElementById('productImagePreview').style.display = 'none';
            }
            
            // UI ë³€ê²½
            document.getElementById('productFormHeader').textContent = 'ìƒí’ˆ ìˆ˜ì •';
            document.getElementById('productSubmitBtn').textContent = 'ìˆ˜ì •';
            document.getElementById('productCancelBtn').classList.remove('hidden');
            
            // í¼ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            document.getElementById('sectionProducts').scrollIntoView({ behavior: 'smooth' });
        }
        
        function cancelEditProduct() {
            document.getElementById('editProductId').value = '';
            document.getElementById('productFormHeader').textContent = 'ìƒí’ˆ ë“±ë¡';
            document.getElementById('productSubmitBtn').textContent = 'ë“±ë¡';
            document.getElementById('productCancelBtn').classList.add('hidden');
            clearProductForm();
        }
        
        function clearProductForm() {
            document.getElementById('productName').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productLink').value = '';
            document.getElementById('productCategory').value = '';
            document.getElementById('productImage').value = '';
            document.getElementById('productStartDate').value = '';
            document.getElementById('productEndDate').value = '';
            document.getElementById('productImagePreview').style.display = 'none';
            document.getElementById('productImageFile').value = '';
        }
        
        async function deleteProduct(id) { 
            if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return; 
            data.products = data.products.filter(p => String(p.id) !== String(id)); 
            await deleteProductFromFirebase(id);
            saveDataLocal(); 
            updateAll(); 
            showToast('ì‚­ì œë¨'); 
        }

        async function addSale() {
            const productId = document.getElementById('saleProduct').value;
            const userCode = document.getElementById('saleInfluencer').value;
            const qty = parseInt(document.getElementById('saleQty').value) || 0;
            const amount = parseInt(document.getElementById('saleAmount').value) || 0;
            if (!productId || !userCode || !qty || !amount) { showToast('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”', 'error'); return; }
            const product = data.products.find(p => String(p.id) === String(productId));
            const user = data.users.find(u => u.code === userCode);
            if (!product || !user) return;
            const sale = {
                id: Date.now(), 
                productId: product.id, 
                productName: product.name, 
                userCode: user.code, 
                userName: user.name, 
                quantity: qty, 
                amount, 
                commission: Math.floor(amount * 0.1), 
                date: new Date().toISOString()
            };
            data.sales.push(sale);
            await saveSaleToFirebase(sale);
            saveDataLocal(); 
            updateAll(); 
            showToast('íŒë§¤ ë“±ë¡ë¨');
            document.getElementById('saleQty').value = '1';
            document.getElementById('saleAmount').value = '';
        }
        
        async function deleteSale(id) { 
            if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return; 
            data.sales = data.sales.filter(s => String(s.id) !== String(id)); 
            await deleteSaleFromFirebase(id);
            saveDataLocal(); 
            updateAll(); 
            showToast('ì‚­ì œë¨'); 
        }

        function showToast(msg, type) { 
            const t = document.getElementById('toast'); 
            t.textContent = msg; 
            t.className = 'toast ' + (type || '') + ' show'; 
            setTimeout(() => t.classList.remove('show'), 2500); 
        }
        
        // ì„±ê³¼ë¶„ì„ ì—…ë°ì´íŠ¸
        function updateAnalytics() {
            const approved = data.users.filter(u => u.status === 'approved');
            const now = new Date();
            
            // ì¸í”Œë£¨ì–¸ì„œë³„ íŒë§¤ ì§‘ê³„
            const influencerStats = approved.map(u => {
                const sales = data.sales.filter(s => s.userCode === u.code);
                const totalSales = sales.reduce((sum, s) => sum + (s.quantity || 0), 0);
                const totalAmount = sales.reduce((sum, s) => sum + (s.amount || 0), 0);
                const totalCommission = sales.reduce((sum, s) => sum + (s.commission || 0), 0);
                const lastSale = sales.length > 0 ? sales.sort((a,b) => new Date(b.date) - new Date(a.date))[0].date : null;
                
                return {
                    ...u,
                    totalSales,
                    totalAmount,
                    totalCommission,
                    lastSale,
                    isActive: totalSales > 0
                };
            });
            
            // í™œë™ ì¸í”Œë£¨ì–¸ì„œ (íŒë§¤ ìˆìŒ)
            const activeInfluencers = influencerStats.filter(i => i.isActive);
            
            // ì´ë²ˆ ë‹¬ ë§¤ì¶œ
            const monthSales = data.sales.filter(s => {
                const d = new Date(s.date);
                return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
            });
            const monthTotalAmount = monthSales.reduce((sum, s) => sum + (s.amount || 0), 0);
            
            // ìš”ì•½ ì¹´ë“œ ì—…ë°ì´íŠ¸
            document.getElementById('analyticsTotalInfluencers').textContent = approved.length;
            document.getElementById('analyticsActiveInfluencers').textContent = activeInfluencers.length;
            document.getElementById('analyticsAvgSales').textContent = approved.length > 0 
                ? 'â‚©' + Math.floor(influencerStats.reduce((sum, i) => sum + i.totalAmount, 0) / approved.length).toLocaleString()
                : 'â‚©0';
            document.getElementById('analyticsMonthSales').textContent = 'â‚©' + monthTotalAmount.toLocaleString();
            
            // TOP ì¸í”Œë£¨ì–¸ì„œ í…Œì´ë¸” (ë§¤ì¶œ ìˆœ)
            const topInfluencers = [...influencerStats].sort((a, b) => b.totalAmount - a.totalAmount);
            document.getElementById('topInfluencersTable').innerHTML = topInfluencers.length === 0
                ? '<tr><td colspan="7" class="empty">ì¸í”Œë£¨ì–¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>'
                : topInfluencers.slice(0, 10).map((u, idx) => {
                    const medal = idx === 0 ? 'ğŸ¥‡' : idx === 1 ? 'ğŸ¥ˆ' : idx === 2 ? 'ğŸ¥‰' : (idx + 1);
                    const ch = [u.channels?.youtube && 'YT', u.channels?.instagram && 'IG', u.channels?.tiktok && 'TT', u.channels?.blog && 'Blog'].filter(Boolean).join(', ');
                    let channelLinks = [];
                    if (u.channelUrls?.youtube) channelLinks.push(`<a href="${u.channelUrls.youtube}" target="_blank" style="color:var(--primary)">YT</a>`);
                    if (u.channelUrls?.instagram) channelLinks.push(`<a href="${u.channelUrls.instagram}" target="_blank" style="color:var(--primary)">IG</a>`);
                    if (u.channelUrls?.blog) channelLinks.push(`<a href="${u.channelUrls.blog}" target="_blank" style="color:var(--primary)">Blog</a>`);
                    if (u.channelUrls?.tiktok) channelLinks.push(`<a href="${u.channelUrls.tiktok}" target="_blank" style="color:var(--primary)">TT</a>`);
                    const urlLinks = channelLinks.length > 0 ? channelLinks.join(' ') : ch;
                    return `<tr>
                        <td><strong>${medal}</strong></td>
                        <td>${u.name}</td>
                        <td>${urlLinks || '-'}</td>
                        <td>${u.totalSales}ê±´</td>
                        <td><strong>â‚©${u.totalAmount.toLocaleString()}</strong></td>
                        <td style="color:var(--success)">â‚©${u.totalCommission.toLocaleString()}</td>
                        <td>${u.lastSale ? new Date(u.lastSale).toLocaleDateString('ko-KR') : '-'}</td>
                    </tr>`;
                }).join('');
            
            // ì¹´í…Œê³ ë¦¬ë³„ ì„±ê³¼
            const categoryStats = {};
            Object.keys(categoryNames).forEach(cat => {
                categoryStats[cat] = { sales: 0, amount: 0, topInfluencer: null, topAmount: 0, productCount: 0 };
            });
            
            // ìƒí’ˆë³„ ì¹´í…Œê³ ë¦¬ íŒë§¤ ì§‘ê³„
            data.sales.forEach(sale => {
                const product = data.products.find(p => String(p.id) === String(sale.productId));
                if (product && product.category && categoryStats[product.category]) {
                    categoryStats[product.category].sales += sale.quantity || 0;
                    categoryStats[product.category].amount += sale.amount || 0;
                    
                    // TOP ì¸í”Œë£¨ì–¸ì„œ ì°¾ê¸°
                    const influencer = approved.find(u => u.code === sale.userCode);
                    if (influencer) {
                        const influencerCatAmount = data.sales
                            .filter(s => s.userCode === sale.userCode && data.products.find(p => String(p.id) === String(s.productId))?.category === product.category)
                            .reduce((sum, s) => sum + (s.amount || 0), 0);
                        if (influencerCatAmount > categoryStats[product.category].topAmount) {
                            categoryStats[product.category].topInfluencer = influencer.name;
                            categoryStats[product.category].topAmount = influencerCatAmount;
                        }
                    }
                }
            });
            
            // ì¹´í…Œê³ ë¦¬ë³„ ìƒí’ˆ ìˆ˜
            data.products.forEach(p => {
                if (p.category && categoryStats[p.category]) {
                    categoryStats[p.category].productCount++;
                }
            });
            
            document.getElementById('categoryAnalyticsTable').innerHTML = Object.entries(categoryStats)
                .filter(([cat, stats]) => stats.sales > 0 || stats.productCount > 0)
                .sort((a, b) => b[1].amount - a[1].amount)
                .map(([cat, stats]) => `<tr>
                    <td>${categoryNames[cat]}</td>
                    <td>${stats.sales}ê±´</td>
                    <td><strong>â‚©${stats.amount.toLocaleString()}</strong></td>
                    <td>${stats.topInfluencer || '-'}</td>
                    <td>${stats.productCount}ê°œ</td>
                </tr>`).join('') || '<tr><td colspan="5" class="empty">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
            
            // ì±„ë„ë³„ ì„±ê³¼
            const channelStats = {
                youtube: { name: 'YouTube', count: 0, sales: 0, amount: 0 },
                instagram: { name: 'Instagram', count: 0, sales: 0, amount: 0 },
                blog: { name: 'ë¸”ë¡œê·¸', count: 0, sales: 0, amount: 0 },
                tiktok: { name: 'TikTok', count: 0, sales: 0, amount: 0 }
            };
            
            approved.forEach(u => {
                const userSales = data.sales.filter(s => s.userCode === u.code);
                const userAmount = userSales.reduce((sum, s) => sum + (s.amount || 0), 0);
                const userSalesCount = userSales.reduce((sum, s) => sum + (s.quantity || 0), 0);
                
                Object.keys(channelStats).forEach(ch => {
                    if (u.channels && u.channels[ch]) {
                        channelStats[ch].count++;
                        channelStats[ch].sales += userSalesCount;
                        channelStats[ch].amount += userAmount;
                    }
                });
            });
            
            document.getElementById('channelAnalyticsTable').innerHTML = Object.values(channelStats)
                .filter(ch => ch.count > 0)
                .sort((a, b) => b.amount - a.amount)
                .map(ch => `<tr>
                    <td>${ch.name}</td>
                    <td>${ch.count}ëª…</td>
                    <td>${ch.sales}ê±´</td>
                    <td><strong>â‚©${ch.amount.toLocaleString()}</strong></td>
                    <td>â‚©${ch.count > 0 ? Math.floor(ch.amount / ch.count).toLocaleString() : 0}</td>
                </tr>`).join('') || '<tr><td colspan="5" class="empty">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
            
            // ì¸í”Œë£¨ì–¸ì„œ ìƒì„¸ DB
            updateInfluencerDB(influencerStats);
        }
        
        function updateInfluencerDB(influencerStats) {
            const filter = document.getElementById('analyticsFilter').value;
            const categoryFilter = document.getElementById('analyticsCategoryFilter').value;
            
            let filtered = [...influencerStats];
            
            // í™œë™ í•„í„°
            if (filter === 'active') {
                filtered = filtered.filter(i => i.isActive);
            } else if (filter === 'inactive') {
                filtered = filtered.filter(i => !i.isActive);
            }
            
            // ì¹´í…Œê³ ë¦¬ í•„í„°
            if (categoryFilter !== 'all') {
                filtered = filtered.filter(i => i.categories && i.categories[categoryFilter]);
            }
            
            // ë§¤ì¶œ ìˆœ ì •ë ¬
            filtered.sort((a, b) => b.totalAmount - a.totalAmount);
            
            document.getElementById('influencerDBTable').innerHTML = filtered.length === 0
                ? '<tr><td colspan="8" class="empty">í•´ë‹¹ ì¡°ê±´ì˜ ì¸í”Œë£¨ì–¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>'
                : filtered.map(u => {
                    const ch = [u.channels?.youtube && 'YT', u.channels?.instagram && 'IG', u.channels?.tiktok && 'TT', u.channels?.blog && 'Blog'].filter(Boolean).join(', ');
                    let channelLinks = [];
                    if (u.channelUrls?.youtube) channelLinks.push(`<a href="${u.channelUrls.youtube}" target="_blank" style="color:var(--primary)">YT</a>`);
                    if (u.channelUrls?.instagram) channelLinks.push(`<a href="${u.channelUrls.instagram}" target="_blank" style="color:var(--primary)">IG</a>`);
                    if (u.channelUrls?.blog) channelLinks.push(`<a href="${u.channelUrls.blog}" target="_blank" style="color:var(--primary)">Blog</a>`);
                    if (u.channelUrls?.tiktok) channelLinks.push(`<a href="${u.channelUrls.tiktok}" target="_blank" style="color:var(--primary)">TT</a>`);
                    const urlLinks = channelLinks.length > 0 ? channelLinks.join(' ') : ch;
                    
                    const cats = u.categories ? Object.keys(u.categories).filter(k => u.categories[k]).map(k => categoryNames[k] || k).join(', ') : '-';
                    const memo = u.memo || '';
                    
                    return `<tr>
                        <td><strong>${u.name}</strong><br><span style="font-size:11px;color:var(--text-light)">${u.code || '-'}</span></td>
                        <td style="font-size:12px">${u.contact || '-'}</td>
                        <td>${urlLinks || '-'}</td>
                        <td style="font-size:11px">${cats}</td>
                        <td>${u.totalSales}ê±´</td>
                        <td><strong>â‚©${u.totalAmount.toLocaleString()}</strong></td>
                        <td style="font-size:11px">${u.createdAt ? new Date(u.createdAt).toLocaleDateString('ko-KR') : '-'}</td>
                        <td><input type="text" value="${memo}" placeholder="ë©”ëª¨" style="width:80px;padding:4px;font-size:11px;border:1px solid var(--border);border-radius:4px" onchange="saveMemo('${u.googleEmail || u.id}', this.value)"></td>
                    </tr>`;
                }).join('');
        }
        
        async function saveMemo(docId, memo) {
            const user = data.users.find(u => (u.googleEmail || u.id) === docId);
            if (user) {
                user.memo = memo;
                await saveUserToFirebase(user);
                saveDataLocal();
                showToast('ë©”ëª¨ ì €ì¥ë¨');
            }
        }
        
        // ============ ì¸í”Œë£¨ì–¸ì„œ DB ============
        function renderInfluencerDB() {
            filterInfluencerDB();
        }
        
        function filterInfluencerDB() {
            const search = document.getElementById('dbSearch').value.toLowerCase();
            const channelFilter = document.getElementById('dbChannelFilter').value;
            const categoryFilter = document.getElementById('dbCategoryFilter').value;
            const statusFilter = document.getElementById('dbStatusFilter').value;
            const gradeFilter = document.getElementById('dbGradeFilter')?.value || 'all';
            
            const approved = data.users.filter(u => u.status === 'approved');
            
            // í•„í„°ë§
            let filtered = approved.filter(u => {
                // ê²€ìƒ‰ì–´ í•„í„°
                if (search) {
                    const searchFields = [
                        u.name || '',
                        u.contact || '',
                        u.googleEmail || '',
                        u.channelUrls?.youtube || '',
                        u.channelUrls?.instagram || '',
                        u.channelUrls?.blog || '',
                        u.channelUrls?.tiktok || '',
                        u.memo || ''
                    ].join(' ').toLowerCase();
                    if (!searchFields.includes(search)) return false;
                }
                
                // ì±„ë„ í•„í„°
                if (channelFilter !== 'all') {
                    if (!u.channels || !u.channels[channelFilter]) return false;
                }
                
                // ì¹´í…Œê³ ë¦¬ í•„í„°
                if (categoryFilter !== 'all') {
                    if (!u.categories || !u.categories[categoryFilter]) return false;
                }
                
                // ìƒíƒœ í•„í„°
                const userSales = data.sales.filter(s => s.userCode === u.code);
                const totalSales = userSales.reduce((sum, s) => sum + (s.quantity || 0), 0);
                
                if (statusFilter === 'active' && totalSales === 0) return false;
                if (statusFilter === 'inactive' && totalSales > 0) return false;
                
                // ë“±ê¸‰ í•„í„°
                if (gradeFilter !== 'all') {
                    const grade = getUserGrade(totalSales);
                    if (grade.id !== gradeFilter) return false;
                }
                
                return true;
            });
            
            // ì¹´ë“œ ë Œë”ë§
            const container = document.getElementById('influencerCardList');
            
            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty" style="grid-column:1/-1">ì¡°ê±´ì— ë§ëŠ” ì¸í”Œë£¨ì–¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }
            
            container.innerHTML = filtered.map(u => {
                const userSales = data.sales.filter(s => s.userCode === u.code);
                const totalSales = userSales.reduce((sum, s) => sum + (s.quantity || 0), 0);
                const totalAmount = userSales.reduce((sum, s) => sum + (s.amount || 0), 0);
                const totalCommission = userSales.reduce((sum, s) => sum + (s.commission || 0), 0);
                
                // ìƒˆë¡œìš´ ë“±ê¸‰ ì‹œìŠ¤í…œ ì ìš©
                const grade = getUserGrade(totalSales);
                const nextInfo = getNextGradeInfo(totalSales);
                
                // ì±„ë„
                let channels = [];
                if (u.channels?.youtube) channels.push('<span class="influencer-card-channel youtube">YouTube</span>');
                if (u.channels?.instagram) channels.push('<span class="influencer-card-channel instagram">Instagram</span>');
                if (u.channels?.blog) channels.push('<span class="influencer-card-channel blog">ë¸”ë¡œê·¸</span>');
                if (u.channels?.tiktok) channels.push('<span class="influencer-card-channel tiktok">TikTok</span>');
                
                // ì¹´í…Œê³ ë¦¬
                let cats = [];
                if (u.categories) {
                    Object.keys(u.categories).forEach(k => {
                        if (u.categories[k]) cats.push(categoryNames[k] || k);
                    });
                }
                
                // ë§¤ì¹­ëœ ìƒí’ˆ
                let matchedHtml = '';
                if (u.matchedProducts && u.matchedProducts.length > 0) {
                    const matchedNames = u.matchedProducts.map(pid => {
                        const p = data.products.find(x => String(x.id) === String(pid));
                        return p ? p.name : '';
                    }).filter(Boolean).slice(0, 2);
                    if (matchedNames.length > 0) {
                        matchedHtml = `<div class="influencer-card-matched">
                            <div class="influencer-card-matched-title">ë§¤ì¹­ ìƒí’ˆ</div>
                            <div class="influencer-card-matched-products">${matchedNames.join(', ')}${u.matchedProducts.length > 2 ? ' ì™¸ ' + (u.matchedProducts.length - 2) + 'ê°œ' : ''}</div>
                        </div>`;
                    }
                }
                
                return `
                <div class="influencer-card" onclick="openInfluencerModal('${u.googleEmail || u.id}')">
                    <div class="influencer-card-header">
                        <div class="influencer-card-avatar" style="background:${grade.bgColor};color:${grade.color}">${u.name ? u.name.charAt(0) : 'U'}</div>
                        <div class="influencer-card-info">
                            <h4>${u.name || '-'}</h4>
                            <p>${u.code || '-'} Â· ${u.contact || '-'}</p>
                        </div>
                        <span class="influencer-card-grade" style="background:${grade.bgColor};color:${grade.color}">${grade.icon} ${grade.name}</span>
                    </div>
                    <div class="influencer-card-grade-info">
                        <span class="grade-commission">ìˆ˜ìˆ˜ë£Œ ${grade.commission}%</span>
                        <span class="grade-benefit">ğŸ ${grade.benefit}</span>
                    </div>
                    <div class="influencer-card-progress">
                        <div class="progress-bar"><div class="progress-fill" style="width:${nextInfo ? Math.min(100, (totalSales / nextInfo.nextGrade.minSales) * 100) : 100}%"></div></div>
                        <span class="progress-text">${nextInfo ? `ë‹¤ìŒ ë“±ê¸‰ê¹Œì§€ ${nextInfo.remaining}ê±´` : 'ìµœê³  ë“±ê¸‰!'}</span>
                    </div>
                    <div class="influencer-card-channels">${channels.join('') || '<span style="color:var(--text-light);font-size:11px">ì±„ë„ ë¯¸ë“±ë¡</span>'}</div>
                    <div class="influencer-card-categories">ğŸ·ï¸ ${cats.length > 0 ? cats.join(', ') : 'ì¹´í…Œê³ ë¦¬ ë¯¸ì„ íƒ'}</div>
                    <div class="influencer-card-stats">
                        <div class="influencer-card-stat"><span class="num">${totalSales}</span><span class="label">íŒë§¤</span></div>
                        <div class="influencer-card-stat"><span class="num">â‚©${totalAmount.toLocaleString()}</span><span class="label">ë§¤ì¶œ</span></div>
                        <div class="influencer-card-stat"><span class="num">â‚©${totalCommission.toLocaleString()}</span><span class="label">ìˆ˜ìµ</span></div>
                    </div>
                    ${u.memo ? `<div class="influencer-card-memo">ğŸ“ ${u.memo}</div>` : ''}
                    ${matchedHtml}
                </div>
                `;
            }).join('');
        }
        
        function openInfluencerModal(id) {
            const user = data.users.find(u => (u.googleEmail || u.id) === id);
            if (!user) return;
            
            document.getElementById('modalInfluencerId').value = id;
            document.getElementById('modalInfluencerName').textContent = user.name + ' ìƒì„¸ ì •ë³´';
            document.getElementById('modalName').textContent = user.name || '-';
            document.getElementById('modalCode').textContent = user.code || '-';
            document.getElementById('modalContact').textContent = user.contact || '-';
            document.getElementById('modalEmail').textContent = user.googleEmail || '-';
            document.getElementById('modalJoinDate').textContent = user.createdAt ? new Date(user.createdAt).toLocaleDateString('ko-KR') : '-';
            
            // ë“±ê¸‰ ì •ë³´ ê³„ì‚°
            const userSales = data.sales.filter(s => s.userCode === user.code);
            const totalSales = userSales.reduce((sum, s) => sum + (s.quantity || 0), 0);
            const grade = getUserGrade(totalSales);
            const nextInfo = getNextGradeInfo(totalSales);
            
            // ë“±ê¸‰ í‘œì‹œ
            document.getElementById('modalGradeIcon').textContent = grade.icon;
            document.getElementById('modalGradeName').textContent = grade.name;
            document.getElementById('modalGradeCommission').textContent = `ìˆ˜ìˆ˜ë£Œ ${grade.commission}%`;
            document.getElementById('modalGradeBenefit').textContent = `ğŸ ${grade.benefit}`;
            
            if (nextInfo) {
                const progress = ((totalSales - grade.minSales) / (nextInfo.nextGrade.minSales - grade.minSales)) * 100;
                document.getElementById('modalGradeProgressFill').style.width = Math.min(100, progress) + '%';
                document.getElementById('modalGradeProgressText').textContent = `ë‹¤ìŒ ë“±ê¸‰ ${nextInfo.nextGrade.icon} ${nextInfo.nextGrade.name}ê¹Œì§€ ${nextInfo.remaining}ê±´ ë‚¨ìŒ`;
            } else {
                document.getElementById('modalGradeProgressFill').style.width = '100%';
                document.getElementById('modalGradeProgressText').textContent = 'ğŸ‰ ìµœê³  ë“±ê¸‰ ë‹¬ì„±!';
            }
            
            // ì±„ë„
            const channelConfig = {youtube:{name:'YouTube',icon:'YT'},instagram:{name:'Instagram',icon:'IG'},blog:{name:'ë¸”ë¡œê·¸',icon:'B'},tiktok:{name:'TikTok',icon:'TT'}};
            let channelHtml = '';
            Object.keys(channelConfig).forEach(key => {
                if (user.channels && user.channels[key]) {
                    const url = user.channelUrls?.[key] || '';
                    channelHtml += `<div class="modal-channel-item">
                        <div class="modal-channel-icon ${key}">${channelConfig[key].icon}</div>
                        <div>
                            <div style="font-size:13px;font-weight:500">${channelConfig[key].name}</div>
                            ${url ? `<a href="${url}" target="_blank" class="modal-channel-url">${url}</a>` : '<span style="font-size:11px;color:var(--text-light)">URL ë¯¸ë“±ë¡</span>'}
                        </div>
                    </div>`;
                }
            });
            document.getElementById('modalChannels').innerHTML = channelHtml || '<p style="color:var(--text-light);font-size:13px">ë“±ë¡ëœ ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤</p>';
            
            // ì¹´í…Œê³ ë¦¬
            let catHtml = '';
            if (user.categories) {
                Object.keys(user.categories).forEach(k => {
                    if (user.categories[k]) {
                        catHtml += `<span class="modal-category-tag">${categoryNames[k] || k}</span>`;
                    }
                });
            }
            document.getElementById('modalCategories').innerHTML = catHtml || '<p style="color:var(--text-light);font-size:13px">ì„ íƒëœ ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
            
            // íŒë§¤ ì‹¤ì 
            const totalAmount = userSales.reduce((sum, s) => sum + (s.amount || 0), 0);
            const totalCommission = userSales.reduce((sum, s) => sum + (s.commission || 0), 0);
            
            document.getElementById('modalTotalSales').textContent = totalSales + 'ê±´';
            document.getElementById('modalTotalAmount').textContent = 'â‚©' + totalAmount.toLocaleString();
            document.getElementById('modalTotalCommission').textContent = 'â‚©' + totalCommission.toLocaleString();
            
            // íŒë§¤ ì´ë ¥
            const recentSales = userSales.sort((a,b) => new Date(b.date) - new Date(a.date)).slice(0, 10);
            document.getElementById('modalSalesHistory').innerHTML = recentSales.length === 0
                ? '<p style="color:var(--text-light);font-size:12px;padding:12px 0">íŒë§¤ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤</p>'
                : recentSales.map(s => `<div class="modal-sales-item">
                    <span>${new Date(s.date).toLocaleDateString('ko-KR')}</span>
                    <span>${s.productName}</span>
                    <span>${s.quantity || 0}ê°œ</span>
                    <span style="color:var(--success)">â‚©${(s.commission || 0).toLocaleString()}</span>
                </div>`).join('');
            
            // ìƒí’ˆ ë§¤ì¹­
            const matchedProducts = user.matchedProducts || [];
            document.getElementById('modalProductMatch').innerHTML = data.products.map(p => {
                const checked = matchedProducts.includes(String(p.id)) ? 'checked' : '';
                return `<div class="product-match-item">
                    <input type="checkbox" id="match_${p.id}" value="${p.id}" ${checked}>
                    <div class="product-match-info">
                        <div class="product-match-name">${p.name}</div>
                        <div class="product-match-category">${categoryNames[p.category] || p.category || '-'} Â· â‚©${(p.price || 0).toLocaleString()}</div>
                    </div>
                </div>`;
            }).join('') || '<p style="color:var(--text-light);font-size:12px">ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤</p>';
            
            // ë©”ëª¨
            document.getElementById('modalMemo').value = user.memo || '';
            
            // ë“±ê¸‰ ë¼ë””ì˜¤ ë²„íŠ¼ (ê¸°ì¡´ ìˆ˜ë™ ë“±ê¸‰ ì„¤ì •ìš©)
            const userGradeValue = user.grade || 'normal';
            document.querySelectorAll('input[name="influencerGrade"]').forEach(input => {
                input.checked = input.value === userGradeValue;
            });
            
            document.getElementById('influencerModal').classList.add('show');
        }
        
        function closeInfluencerModal() {
            document.getElementById('influencerModal').classList.remove('show');
        }
        
        async function saveInfluencerDetail() {
            const id = document.getElementById('modalInfluencerId').value;
            const user = data.users.find(u => (u.googleEmail || u.id) === id);
            if (!user) return;
            
            // ë§¤ì¹­ ìƒí’ˆ
            const matchedProducts = [];
            document.querySelectorAll('#modalProductMatch input[type="checkbox"]:checked').forEach(input => {
                matchedProducts.push(input.value);
            });
            user.matchedProducts = matchedProducts;
            
            // ë©”ëª¨
            user.memo = document.getElementById('modalMemo').value;
            
            // ë“±ê¸‰
            const gradeInput = document.querySelector('input[name="influencerGrade"]:checked');
            user.grade = gradeInput ? gradeInput.value : 'normal';
            
            // ì €ì¥
            await saveUserToFirebase(user);
            saveDataLocal();
            
            closeInfluencerModal();
            renderInfluencerDB();
            showToast('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        // ========================================
        // ì¸í”Œë£¨ì–¸ì„œ ë§¤ì¹­ ê¸°ëŠ¥
        // ========================================
        
        function initMatchingSection() {
            // ìƒí’ˆ ëª©ë¡ ë¡œë“œ
            const productSelect = document.getElementById('matchingProductSelect');
            productSelect.innerHTML = '<option value="">ìƒí’ˆì„ ì„ íƒí•˜ì„¸ìš”</option>' + 
                data.products.map(p => `<option value="${p.id}">${p.name} (${categoryNames[p.category] || p.category})</option>`).join('');
            
            updateMatching();
        }
        
        function updateMatching() {
            const productId = document.getElementById('matchingProductSelect').value;
            const channelFilter = document.getElementById('matchingChannelFilter').value;
            const categoryFilter = document.getElementById('matchingCategoryFilter').value;
            const sortFilter = document.getElementById('matchingSortFilter').value;
            const statusFilter = document.getElementById('matchingStatusFilter').value;
            
            // ì„ íƒëœ ìƒí’ˆ ì •ë³´ í‘œì‹œ
            const productInfoEl = document.getElementById('selectedProductInfo');
            const selectedProduct = data.products.find(p => String(p.id) === String(productId));
            
            if (selectedProduct) {
                productInfoEl.classList.remove('hidden');
                document.getElementById('selectedProductImg').src = selectedProduct.image || 'https://via.placeholder.com/80';
                document.getElementById('selectedProductName').textContent = selectedProduct.name;
                document.getElementById('selectedProductCategory').textContent = categoryNames[selectedProduct.category] || selectedProduct.category;
                document.getElementById('selectedProductPrice').textContent = 'â‚©' + (selectedProduct.price || 0).toLocaleString();
            } else {
                productInfoEl.classList.add('hidden');
            }
            
            // ì¸í”Œë£¨ì–¸ì„œ í•„í„°ë§
            let influencers = data.users.filter(u => u.status === 'approved');
            
            // ì±„ë„ í•„í„°
            if (channelFilter !== 'all') {
                influencers = influencers.filter(u => u.channels && u.channels[channelFilter]);
            }
            
            // ì¹´í…Œê³ ë¦¬ í•„í„°
            if (categoryFilter !== 'all') {
                influencers = influencers.filter(u => u.categories && u.categories[categoryFilter]);
            }
            
            // í™œë™ ìƒíƒœ í•„í„°
            if (statusFilter !== 'all') {
                influencers = influencers.filter(u => {
                    const userSales = data.sales.filter(s => s.userCode === u.code);
                    if (statusFilter === 'active') return userSales.length > 0;
                    return userSales.length === 0;
                });
            }
            
            // ë§¤ì¹­ ì ìˆ˜ ê³„ì‚°
            influencers = influencers.map(u => {
                const matchScore = calculateMatchScore(u, selectedProduct);
                const userSales = data.sales.filter(s => s.userCode === u.code);
                const totalSales = userSales.reduce((sum, s) => sum + (s.quantity || 1), 0);
                const totalAmount = userSales.reduce((sum, s) => sum + (s.amount || 0), 0);
                
                return {
                    ...u,
                    matchScore,
                    totalSales,
                    totalAmount
                };
            });
            
            // ì •ë ¬
            if (sortFilter === 'match') {
                influencers.sort((a, b) => b.matchScore - a.matchScore);
            } else if (sortFilter === 'sales') {
                influencers.sort((a, b) => b.totalSales - a.totalSales);
            } else if (sortFilter === 'recent') {
                influencers.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));
            }
            
            // ê²°ê³¼ ë Œë”ë§
            renderMatchingResults(influencers, selectedProduct);
        }
        
        function calculateMatchScore(user, product) {
            if (!product) return 0;
            
            let score = 0;
            
            // 1. ì¹´í…Œê³ ë¦¬ ë§¤ì¹­ (40ì )
            if (user.categories && user.categories[product.category]) {
                score += 40;
            }
            
            // 2. ì±„ë„ ë³´ìœ  (20ì )
            const channelCount = Object.values(user.channels || {}).filter(v => v).length;
            score += Math.min(20, channelCount * 5);
            
            // 3. íŒë§¤ ì‹¤ì  (20ì )
            const userSales = data.sales.filter(s => s.userCode === user.code);
            const totalSales = userSales.reduce((sum, s) => sum + (s.quantity || 1), 0);
            if (totalSales >= 100) score += 20;
            else if (totalSales >= 50) score += 15;
            else if (totalSales >= 20) score += 10;
            else if (totalSales >= 5) score += 5;
            
            // 4. ê°™ì€ ì¹´í…Œê³ ë¦¬ íŒë§¤ ê²½í—˜ (20ì )
            const categorySales = userSales.filter(s => {
                const p = data.products.find(prod => String(prod.id) === String(s.productId));
                return p && p.category === product.category;
            });
            if (categorySales.length > 0) {
                score += Math.min(20, categorySales.length * 4);
            }
            
            return Math.min(100, score);
        }
        
        function renderMatchingResults(influencers, selectedProduct) {
            const container = document.getElementById('matchingResults');
            document.getElementById('matchingResultCount').textContent = influencers.length + 'ëª…';
            
            if (influencers.length === 0) {
                container.innerHTML = '<div class="empty-matching">ì¡°ê±´ì— ë§ëŠ” ì¸í”Œë£¨ì–¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }
            
            const channelLabels = { youtube: 'YouTube', instagram: 'Instagram', blog: 'ë¸”ë¡œê·¸', tiktok: 'TikTok' };
            const gradeInfo = {
                seed: { icon: 'ğŸŒ±', name: 'ì”¨ì•—' },
                sprout: { icon: 'ğŸŒ¿', name: 'ìƒˆì‹¹' },
                bronze: { icon: 'ğŸ¥‰', name: 'ë¸Œë¡ ì¦ˆ' },
                silver: { icon: 'ğŸ¥ˆ', name: 'ì‹¤ë²„' },
                gold: { icon: 'ğŸ¥‡', name: 'ê³¨ë“œ' },
                diamond: { icon: 'ğŸ’', name: 'ë‹¤ì´ì•„' },
                vip: { icon: 'ğŸ‘‘', name: 'VIP' }
            };
            
            // ìƒí’ˆëª… (ë¬¸ì ë©”ì‹œì§€ìš©)
            const productName = selectedProduct ? selectedProduct.name : '';
            
            container.innerHTML = influencers.map(u => {
                // ì±„ë„ íƒœê·¸
                const channelTags = Object.entries(u.channels || {})
                    .filter(([k, v]) => v)
                    .map(([k]) => `<span class="matching-channel ${k}">${channelLabels[k] || k}</span>`)
                    .join('');
                
                // ë“±ê¸‰ ê³„ì‚°
                const userGrade = getUserGradeByTotalSales(u.totalSales);
                
                // ì•„ë°”íƒ€
                const avatarContent = u.profileImage 
                    ? `<img src="${u.profileImage}" alt="${u.name}">`
                    : u.name.charAt(0);
                const avatarClass = u.profileImage ? 'matching-avatar has-image' : 'matching-avatar';
                
                // ê´€ì‹¬ ì¹´í…Œê³ ë¦¬
                const userCategories = Object.entries(u.categories || {})
                    .filter(([k, v]) => v)
                    .map(([k]) => categoryNames[k] || k)
                    .slice(0, 3)
                    .join(', ');
                
                // ì—°ë½ì²˜ ë²„íŠ¼ (ì „í™”ë²ˆí˜¸ê°€ ìˆì„ ë•Œë§Œ)
                const contactBtns = u.contact 
                    ? `<div class="matching-contact-btns">
                        <a href="tel:${u.contact}" class="contact-btn call">ì „í™”</a>
                        <a href="sms:${u.contact}?body=ì•ˆë…•í•˜ì„¸ìš” ${u.name}ë‹˜! í•«ë”œê³µêµ¬ì¸í”Œë£¨ì–¸ì„œì…ë‹ˆë‹¤. ${productName ? 'ã€Œ' + productName + 'ã€ ìƒí’ˆ í˜‘ì—… ì œì•ˆë“œë¦½ë‹ˆë‹¤.' : 'í˜‘ì—… ì œì•ˆë“œë¦½ë‹ˆë‹¤.'}" class="contact-btn sms">ë¬¸ì</a>
                       </div>`
                    : `<div class="matching-contact-btns"><span class="no-contact">ì—°ë½ì²˜ ì—†ìŒ</span></div>`;
                
                return `
                <div class="matching-card">
                    <div class="${avatarClass}">${avatarContent}</div>
                    <div class="matching-info">
                        <div class="matching-name">
                            ${u.name}
                            <span class="matching-grade">${userGrade.icon} ${userGrade.name}</span>
                        </div>
                        <div class="matching-meta">${userCategories || 'ì¹´í…Œê³ ë¦¬ ë¯¸ì„¤ì •'}</div>
                        <div class="matching-channels">${channelTags || '<span style="color:var(--text-light);font-size:11px">ì±„ë„ ë¯¸ë“±ë¡</span>'}</div>
                        <div class="matching-stats">
                            <span class="matching-stat">íŒë§¤ <strong>${u.totalSales}ê±´</strong></span>
                            <span class="matching-stat">ë§¤ì¶œ <strong>â‚©${u.totalAmount.toLocaleString()}</strong></span>
                        </div>
                        ${contactBtns}
                    </div>
                    <div class="matching-score">
                        <div class="matching-score-value">${u.matchScore}%</div>
                        <div class="matching-score-label">ë§¤ì¹­ë¥ </div>
                    </div>
                </div>
                `;
            }).join('');
        }
        
        function getUserGradeByTotalSales(totalSales) {
            const grades = [
                { id: 'vip', name: 'VIP', icon: 'ğŸ‘‘', minSales: 500 },
                { id: 'diamond', name: 'ë‹¤ì´ì•„', icon: 'ğŸ’', minSales: 300 },
                { id: 'gold', name: 'ê³¨ë“œ', icon: 'ğŸ¥‡', minSales: 100 },
                { id: 'silver', name: 'ì‹¤ë²„', icon: 'ğŸ¥ˆ', minSales: 50 },
                { id: 'bronze', name: 'ë¸Œë¡ ì¦ˆ', icon: 'ğŸ¥‰', minSales: 20 },
                { id: 'sprout', name: 'ìƒˆì‹¹', icon: 'ğŸŒ¿', minSales: 5 },
                { id: 'seed', name: 'ì”¨ì•—', icon: 'ğŸŒ±', minSales: 0 }
            ];
            
            for (const grade of grades) {
                if (totalSales >= grade.minSales) return grade;
            }
            return grades[grades.length - 1];
        }
    </script>
</body>
</html>
